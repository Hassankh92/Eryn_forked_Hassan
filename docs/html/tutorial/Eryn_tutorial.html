

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Eryn &mdash; Eryn 0.0.1 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "document", "processHtmlClass": "math|output_area"}}</script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="Utilities" href="../user/utils.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: coral" >
          

          
            <a href="../index.html" class="icon icon-home"> Eryn
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Documentation:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../user/ensemble.html">Ensemble</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/state.html">State</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/backend.html">Backends</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/moves.html">Moves</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/prior.html">Priors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/temper.html">Parallel Tempering</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/utils.html">Utilities</a></li>
</ul>
<p class="caption"><span class="caption-text">Tutorial:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Eryn</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#MCMC-Basics">MCMC Basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="#The-Tree-Metaphor">The Tree Metaphor</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Getting-Started-with-the-Ensemble-Sampler">Getting Started with the Ensemble Sampler</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Backend-Objects">Backend Objects</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#5-dimensional-Arrays">5-dimensional Arrays</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#State-Objects">State Objects</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Branches">Branches</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#Parallel-Tempering">Parallel Tempering</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Add-Reversible-Jump-MCMC-(model-count-uncertainty)">Add Reversible Jump MCMC (model count uncertainty)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Add-multiple-branches">Add multiple branches</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#Utilities">Utilities</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Transform-Container">Transform Container</a></li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Eryn</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Eryn</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/tutorial/Eryn_tutorial.ipynb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <div class="rst-breadcrumbs-buttons" role="navigation" aria-label="breadcrumb navigation">
      
      
        <a href="../user/utils.html" class="btn btn-neutral float-left" title="Utilities" accesskey="p"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
      
  </div>
  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>

<span></span><span class="kn">import</span> <span class="nn">sys</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;/Users/michaelkatz/Research/Eryn/&#39;</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">eryn.ensemble</span> <span class="kn">import</span> <span class="n">EnsembleSampler</span>
<span class="kn">from</span> <span class="nn">eryn.state</span> <span class="kn">import</span> <span class="n">State</span>
<span class="kn">from</span> <span class="nn">eryn.prior</span> <span class="kn">import</span> <span class="n">PriorContainer</span><span class="p">,</span> <span class="n">uniform_dist</span>
<span class="kn">from</span> <span class="nn">eryn.utils</span> <span class="kn">import</span> <span class="n">TransformContainer</span>
<span class="kn">from</span> <span class="nn">eryn.moves</span> <span class="kn">import</span> <span class="n">GaussianMove</span>
<span class="kn">from</span> <span class="nn">eryn.utils.utility</span> <span class="kn">import</span> <span class="n">groups_from_inds</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># set random seed</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">corner</span>

</pre></div>
</div>
</div>
<section id="Eryn">
<h1>Eryn<a class="headerlink" href="#Eryn" title="Permalink to this headline">¶</a></h1>
<p>Eryn is an advanced MCMC sampler. It has the capability to run with parallel tempering, multiple model types, and unknown counts within each model type using Reversible-Jump MCMC techniques. Eryn is heavily based on <a class="reference external" href="https://emcee.readthedocs.io/en/stable/">emcee</a>. The <code class="docutils literal notranslate"><span class="pre">emcee</span></code> base structure with the Ensemble Sampler, State objects, proposal setup, and storage backends is carried over into Eryn with small changes to account for the increased complexity. In a simple sense, Eryn is an
advanced (and slightly more complicated) version of <code class="docutils literal notranslate"><span class="pre">emcee</span></code>.</p>
<p>In this tutorial, we will go through much of what is available in Eryn. We will start with a basic sampling operation to illustrate how to build and navigate common objects in Eryn. We will then scale up the complexity to understand how to use Eryn in different circumstances.</p>
<p>If you use Eryn in your publication, please cite (# TODO: add paper). The documentation for Eryn can be found here: (# TODO: add website). You will find the code on Github: <a class="reference external" href="https://github.com/mikekatz04/Eryn">github.com/mikekatz04/Eryn</a>. (# TODO: add zenodo as well)</p>
<section id="MCMC-Basics">
<h2>MCMC Basics<a class="headerlink" href="#MCMC-Basics" title="Permalink to this headline">¶</a></h2>
<p>Here we will go through the basics of MCMC. For a better overall understanding of MCMC, see the Eryn paper: (# TODO: add paper).</p>
<p>The goal of MCMC is to assess the posterior probablity on parameters <span class="math notranslate nohighlight">\((\vec{\theta})\)</span> from a model (<span class="math notranslate nohighlight">\(\mathcal{M}\)</span>), given some data <span class="math notranslate nohighlight">\(y\)</span>: <span class="math notranslate nohighlight">\(p(\vec{\theta}, \mathcal{M}|y)\)</span>. We can rewrite this probability using Bayes’ rule:</p>
<div class="math notranslate nohighlight">
\[p(\vec{\theta}|y)=\frac{p(y|\vec{\theta}, \mathcal{M})p(\vec{\theta}, \mathcal{M})}{p(y|\mathcal{M})}\]</div>
<p>.</p>
<p>Here are the main pieces of the righthand side: * Posterior - <span class="math notranslate nohighlight">\(p(\vec{\theta}|y)\)</span>: The probability distribution on the parameters, the main goal of MCMC. We will refer to this from now on as <span class="math notranslate nohighlight">\(\pi(\vec{\theta})\)</span>. * Likelihood - <span class="math notranslate nohighlight">\(p(y|\vec{\theta}, \mathcal{M})\)</span>: This is the surface that MCMC will sample (weighted by the prior). We will refer to the Likelihood. We will write this from now on as <span class="math notranslate nohighlight">\(\mathcal{L}(\vec{\theta}, \mathcal{M})\)</span>. * Prior -
<span class="math notranslate nohighlight">\(p(\vec{\theta}, \mathcal{M})\)</span>: Prior probability on the parameters and the model chosen. * Evidence - <span class="math notranslate nohighlight">\(p(y|\mathcal{M})\)</span>: The evidence is the integral of the numerator in the equation above integrated over all of the parameter space: <span class="math notranslate nohighlight">\(\int_{\vec{\theta}_\mathcal{M}}\mathcal{L}(\vec{\theta}, \mathcal{M})d\vec{\theta}\)</span>. This will be referred to below as <span class="math notranslate nohighlight">\(Z(\mathcal{M})\)</span> (the evidence of model <span class="math notranslate nohighlight">\(\mathcal{M}\)</span>).</p>
<p>MCMC numerically draws samples from the posterior density by exploring the Likelihood surface weighted by the prior. In most MCMC applications, the evidence will be intractable and ignored as it is just a constant factor over all samples. There are methods to estimate the evidence that we will discuss below.</p>
<p>MCMC is special because of <strong>how it explores</strong>. Using a concept called “Detailed Balance,” walkers exploring the Likelihood surface preferentially move upwards, but probabilistically can move downwards. This allows for a full exploration of the peak of the Likelihood surface rather than just moving directly towards the highest point.</p>
<p>There are requirements to make this work properly that we will discuss below when we discsuss MCMC “moves” or “proposals.” At a basic level, also know as the Metropolis-Hastings algorithm, MCMC works like this: 1. It starts with a current point in parameter space, <span class="math notranslate nohighlight">\(\vec{\theta}_t\)</span>. 2. The sampler proposes a new position for this walker: <span class="math notranslate nohighlight">\(\vec{\theta}_{t+1}\)</span>. 3. It then accepts this new position with probabilty, <span class="math notranslate nohighlight">\(\alpha\)</span>:</p>
<div class="math notranslate nohighlight">
\[\min\left(1, \frac{\pi(\vec{\theta}_{t+1})q(\vec{\theta}_{t}|\vec{\theta}_{t+1})}{\pi(\vec{\theta}_{t})q(\vec{\theta}_{t+1}|\vec{\theta}_{t})}\right)\]</div>
<p>. 4. Repeat many times.</p>
<p><span class="math notranslate nohighlight">\(q\)</span> is the proposal distribution to move from <span class="math notranslate nohighlight">\(\vec{\theta}_{t}\)</span> to <span class="math notranslate nohighlight">\(\vec{\theta}_{t+1}\)</span> or vice versa. If the proposal distribution is symmetric, the <span class="math notranslate nohighlight">\(q\)</span> distributions drop out and we are left with the fraction of posterior probabilities. We can see, in this case, if the new posterior probability is larger than the previous probability, the move will ALWAYS be accepted. If the new posterior probability is worse than the old probability, the move will be accepted with a
probability equal to this fraction. Therefore, as the new value becomes worse and worse compared to the old value, the probability of acceptance decreases.</p>
</section>
<section id="The-Tree-Metaphor">
<h2>The Tree Metaphor<a class="headerlink" href="#The-Tree-Metaphor" title="Permalink to this headline">¶</a></h2>
<p>Before we get into using the sampler, we will discuss the “infamous” tree metaphor. It helped in thinking about the early creation of Eryn and has carried through to the end. <code class="docutils literal notranslate"><span class="pre">Eryn</span></code> is the Sindarin word for “forest” or “woods.” The purpose of this metaphor is to simplify the complex dimensionality associated with changing models and model counts in MCMC. We choose not to use “model” and “model counts” everywhere because those descriptions can quickly become confusing.</p>
<p>We start with a forest with a bunch of trees. These trees are the MCMC “walkers”. Each tree will have the same number of branches which is fixed throughout a sampling run (i.e. each walker has the same base setup). These branches are our different model types. For example, if you have a signal that is a combination of sine waves and Gaussians. In this case, you have two branches, one for the “sine wave” model and one for the “Gaussian” model. The number of Gaussians or sine waves is accounted
for as the number of “leafs” on each branch. So, if 1 walker has 3 Gaussians and 2 sine waves, we can imagine this as a tree with two branches. The first branch for sine waves has 2 leaves and the second branch as 3 leaves for 3 Gaussians.</p>
<p>When we get to parallel tempering, you can imagine different forests at different temperatures, all having the same number of trees (walkers).</p>
<p>(# TODO: add image)</p>
</section>
<section id="Getting-Started-with-the-Ensemble-Sampler">
<h2>Getting Started with the Ensemble Sampler<a class="headerlink" href="#Getting-Started-with-the-Ensemble-Sampler" title="Permalink to this headline">¶</a></h2>
<p>Let’s start by running on a simple multivariate Gaussian likelihood:</p>
<div class="math notranslate nohighlight">
\[\ln{\mathcal{L}}\propto -\frac{1}{2}(\vec{x} - \vec{\mu})^T \tilde{C}^{-1} (\vec{x} - \vec{\mu})\]</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Gaussian likelihood</span>
<span class="k">def</span> <span class="nf">log_like_fn</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">invcov</span><span class="p">):</span>
    <span class="n">diff</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="n">mu</span>
    <span class="k">return</span> <span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">diff</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">invcov</span><span class="p">,</span> <span class="n">diff</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

</pre></div>
</div>
</div>
<p>Add the initial settings: number of dimensions and number of walkers. Then, generate a covariance matrix for the given dimensionality for the likelihood and a set of means for each component of the Gaussian.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">ndim</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">nwalkers</span> <span class="o">=</span> <span class="mi">100</span>

<span class="c1"># mean</span>
<span class="n">means</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">ndim</span><span class="p">)</span>  <span class="c1"># np.random.rand(ndim)</span>

<span class="c1"># define covariance matrix</span>
<span class="n">cov</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">ndim</span><span class="p">))</span>
<span class="n">invcov</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">cov</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Next we will build our priors. For simplicity (and based on this problem), we will use a hyper-cube centered on the means with side length set to be <code class="docutils literal notranslate"><span class="pre">2</span> <span class="pre">*</span> <span class="pre">lims</span></code>. Eryn requires a class object as the prior with an <code class="docutils literal notranslate"><span class="pre">logpdf</span></code> method (similar to <code class="docutils literal notranslate"><span class="pre">scipy.stats</span></code> distributions). Eryn provides a helper class to aid in this process: <code class="docutils literal notranslate"><span class="pre">`eryn.prior.PriorContainer</span></code> &lt;<a class="reference external" href="https://mikekatz04.github.io/Eryn/build/html/user/prior.html#prior-container">https://mikekatz04.github.io/Eryn/build/html/user/prior.html#prior-container</a>&gt;`__. This class takes a dictionary as input. In the simplest
form, the keys are integers representing the index into the array of parameters and the values are the associated distributions: <code class="docutils literal notranslate"><span class="pre">{index:</span> <span class="pre">distribution}</span></code>. Eryn has a wrapper for the <code class="docutils literal notranslate"><span class="pre">scipy.stats.uniform</span></code> class that allows you to enter the start and stop points: <code class="docutils literal notranslate"><span class="pre">`eryn.prior.uniform</span></code> &lt;<a class="reference external" href="https://mikekatz04.github.io/Eryn/build/html/user/prior.html#eryn.prior.uniform_dist">https://mikekatz04.github.io/Eryn/build/html/user/prior.html#eryn.prior.uniform_dist</a>&gt;`__. For example, if we have a 3D space with uniform priors for all dimensions from -1 to 1, the input dictionary would look
like this:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>priors_in = {
    0: uniform_dist(-1, 1),
    1: uniform_dist(-1, 1),
    2: uniform_dist(-1, 1)
}
</pre></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># set prior limits</span>
<span class="n">lims</span> <span class="o">=</span> <span class="mf">5.0</span>
<span class="n">priors_in</span> <span class="o">=</span> <span class="p">{</span><span class="n">i</span><span class="p">:</span> <span class="n">uniform_dist</span><span class="p">(</span><span class="o">-</span><span class="n">lims</span> <span class="o">+</span> <span class="n">means</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">lims</span> <span class="o">+</span> <span class="n">means</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ndim</span><span class="p">)}</span>
<span class="n">priors</span> <span class="o">=</span> <span class="n">PriorContainer</span><span class="p">(</span><span class="n">priors_in</span><span class="p">)</span>

</pre></div>
</div>
</div>
<p>In this case, we are not going to use really any of Eryn’s special capabilities. This will allow us to focus on how to navigate the sampler and deal with its output. Then we can add the fun stuff!</p>
<p>The object that directs everything in Eryn (like in <code class="docutils literal notranslate"><span class="pre">emcee</span></code>) is <code class="docutils literal notranslate"><span class="pre">`eryn.ensemble.EnsembleSampler</span></code> &lt;<a class="reference external" href="https://mikekatz04.github.io/Eryn/build/html/user/ensemble.html#eryn.ensemble.EnsembleSampler">https://mikekatz04.github.io/Eryn/build/html/user/ensemble.html#eryn.ensemble.EnsembleSampler</a>&gt;`__. It required arguments are number of walkers, dimensionality of inputs (for this simple case this is an integer), the log likelihood function, and the priors. Similar to <code class="docutils literal notranslate"><span class="pre">emcee</span></code>, you can add arguments and keyword arguments to the Likelihood function by providing the <code class="docutils literal notranslate"><span class="pre">args</span></code> and <code class="docutils literal notranslate"><span class="pre">kwargs</span></code> keyword
arguments to the <code class="docutils literal notranslate"><span class="pre">EnsembleSampler</span></code>. In this case, we add the means and inverse of the covariance matrix as extra arguments.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">ensemble</span> <span class="o">=</span> <span class="n">EnsembleSampler</span><span class="p">(</span>
    <span class="n">nwalkers</span><span class="p">,</span>
    <span class="n">ndim</span><span class="p">,</span>
    <span class="n">log_like_fn</span><span class="p">,</span>
    <span class="n">priors</span><span class="p">,</span>
    <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">means</span><span class="p">,</span> <span class="n">invcov</span><span class="p">],</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<p>Now we will get starting positions for our walkers by sampling from the priors using the <code class="docutils literal notranslate"><span class="pre">rvs</span></code> method of the <code class="docutils literal notranslate"><span class="pre">PriorContainer</span></code> and then evaluating the associated Likelihood and prior values. The <code class="docutils literal notranslate"><span class="pre">rvs</span></code> method is also called like in <code class="docutils literal notranslate"><span class="pre">scipy.stats</span></code> distributions.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># starting positions</span>
<span class="c1"># randomize throughout prior</span>
<span class="n">coords</span> <span class="o">=</span> <span class="n">priors</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">nwalkers</span><span class="p">,))</span>

<span class="c1"># check log_like</span>
<span class="n">log_like</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span>
    <span class="n">log_like_fn</span><span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">means</span><span class="p">,</span> <span class="n">invcov</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nwalkers</span><span class="p">)])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">log_like</span><span class="p">)</span>

<span class="c1"># check log_prior</span>
<span class="n">log_prior</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span>
    <span class="n">priors</span><span class="o">.</span><span class="n">logpdf</span><span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nwalkers</span><span class="p">)])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">log_prior</span><span class="p">)</span>

</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[-30.69858605 -27.88613553 -10.22294092 -14.70569247 -18.96300942
 -40.24777582 -18.73441074 -24.83741982 -29.01040764 -27.8427905
 -15.6395355  -37.63324244 -37.32945619 -23.65755241 -14.71578138
 -17.41587351 -10.60372232 -14.78508305 -16.44610878 -14.65807937
 -10.96569731 -21.07245692 -21.71012131 -11.7938995  -26.68678623
 -10.56139796 -21.07206293 -15.22766639 -21.70138195 -21.66486977
 -12.67496753 -16.03289018 -29.46929288 -26.72131899 -44.24698912
 -21.3584848  -19.77366496 -28.72150734  -5.84518648 -33.37118884
 -36.15731891 -25.26041351 -25.57594664 -12.25802303 -22.37039294
 -31.88982593 -15.35309536 -24.45627855 -22.46651653 -23.11210745
 -25.31311317 -14.36123373 -23.67409531 -23.41272599 -34.51272062
 -13.40386882 -42.6083427  -10.3819265  -33.56151466 -19.79275524
 -10.09464227 -17.63670509 -15.88594767  -1.5583328  -38.33786195
 -10.04251137 -22.92432228 -26.5383962  -29.02898281 -34.39747766
 -29.93610511 -43.67631032 -37.6288042  -26.57863213 -12.43201382
 -21.71339587 -24.98065915 -22.34629761 -28.53454745 -20.72808992
 -23.58751379 -13.39368888 -12.15662608 -32.82365756  -8.14075088
 -26.22668818 -20.43301692  -8.79050623 -23.10278803 -16.10581548
 -38.66327643 -21.96839538 -19.91765459 -10.73450427 -13.25399003
 -11.51642261 -12.99636574 -21.3527218  -33.90758502 -35.26045709]
[-11.51292546 -11.51292546 -11.51292546 -11.51292546 -11.51292546
 -11.51292546 -11.51292546 -11.51292546 -11.51292546 -11.51292546
 -11.51292546 -11.51292546 -11.51292546 -11.51292546 -11.51292546
 -11.51292546 -11.51292546 -11.51292546 -11.51292546 -11.51292546
 -11.51292546 -11.51292546 -11.51292546 -11.51292546 -11.51292546
 -11.51292546 -11.51292546 -11.51292546 -11.51292546 -11.51292546
 -11.51292546 -11.51292546 -11.51292546 -11.51292546 -11.51292546
 -11.51292546 -11.51292546 -11.51292546 -11.51292546 -11.51292546
 -11.51292546 -11.51292546 -11.51292546 -11.51292546 -11.51292546
 -11.51292546 -11.51292546 -11.51292546 -11.51292546 -11.51292546
 -11.51292546 -11.51292546 -11.51292546 -11.51292546 -11.51292546
 -11.51292546 -11.51292546 -11.51292546 -11.51292546 -11.51292546
 -11.51292546 -11.51292546 -11.51292546 -11.51292546 -11.51292546
 -11.51292546 -11.51292546 -11.51292546 -11.51292546 -11.51292546
 -11.51292546 -11.51292546 -11.51292546 -11.51292546 -11.51292546
 -11.51292546 -11.51292546 -11.51292546 -11.51292546 -11.51292546
 -11.51292546 -11.51292546 -11.51292546 -11.51292546 -11.51292546
 -11.51292546 -11.51292546 -11.51292546 -11.51292546 -11.51292546
 -11.51292546 -11.51292546 -11.51292546 -11.51292546 -11.51292546
 -11.51292546 -11.51292546 -11.51292546 -11.51292546 -11.51292546]
</pre></div></div>
</div>
<p>Because we are in the unit cube, the prior values are constant.</p>
<p>Now, we can run the sampler using the <code class="docutils literal notranslate"><span class="pre">run_mcmc</span></code> method on the <code class="docutils literal notranslate"><span class="pre">EnsembleSampler</span></code> class. It first takes as an argument an array of the starting positions (or a <code class="docutils literal notranslate"><span class="pre">State</span></code> object which we will cover below). We also must provide the number of steps as the second argument. Helpful kwargs (not all inclusive):</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">burn</span></code>: Perform a burn in for a certain number of proposals.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">progress</span></code>: If <code class="docutils literal notranslate"><span class="pre">True</span></code>, show the progress as the sampler runs.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">thin_by</span></code>: How much to thin the chain directly before storage.</p></li>
</ul>
<p>The total number of proposals the sampler will do is <code class="docutils literal notranslate"><span class="pre">nsteps</span> <span class="pre">*</span> <span class="pre">thin_by</span></code>. It will store <code class="docutils literal notranslate"><span class="pre">nsteps</span></code> samples.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">nsteps</span> <span class="o">=</span> <span class="mi">500</span>
<span class="c1"># burn for 1000 steps</span>
<span class="n">burn</span> <span class="o">=</span> <span class="mi">100</span>
<span class="c1"># thin by 5</span>
<span class="n">thin_by</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">out</span> <span class="o">=</span> <span class="n">ensemble</span><span class="o">.</span><span class="n">run_mcmc</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">nsteps</span><span class="p">,</span> <span class="n">burn</span><span class="o">=</span><span class="n">burn</span><span class="p">,</span> <span class="n">progress</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">thin_by</span><span class="o">=</span><span class="n">thin_by</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|██████████████████████████████████████| 1000/1000 [00:03&lt;00:00, 265.07it/s]
100%|████████████████████████████████████| 25000/25000 [01:37&lt;00:00, 255.26it/s]
</pre></div></div>
</div>
<p>Similar to <code class="docutils literal notranslate"><span class="pre">emcee</span></code>, all of the sampler information is stored in a backend object. In the default case, this backend is <code class="docutils literal notranslate"><span class="pre">`eryn.backends.Backend</span></code> &lt;<a class="reference external" href="https://mikekatz04.github.io/Eryn/build/html/user/backend.html#eryn.backends.Backend">https://mikekatz04.github.io/Eryn/build/html/user/backend.html#eryn.backends.Backend</a>&gt;`__. To retrieve the samples from the backend, you call the <code class="docutils literal notranslate"><span class="pre">get_chain</span></code> method. This will return a dictionary with keys at the omdel names and a 5-dimensional array per model, which can be intimidating. We will cover that array just below. For now, just focus on
the output of the sampler.</p>
<p>We will first generate corner plot. In this initial example, we have not defined branch names, therefore, the sampler has assigned our problem default branch names <code class="docutils literal notranslate"><span class="pre">model_0</span></code>,…,<code class="docutils literal notranslate"><span class="pre">model_n</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">samples</span> <span class="o">=</span> <span class="n">ensemble</span><span class="o">.</span><span class="n">get_chain</span><span class="p">()[</span><span class="s1">&#39;model_0&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">ndim</span><span class="p">)</span>
<span class="n">corner</span><span class="o">.</span><span class="n">corner</span><span class="p">(</span><span class="n">samples</span><span class="p">,</span> <span class="n">truths</span><span class="o">=</span><span class="n">means</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_Eryn_tutorial_23_0.png" src="../_images/tutorial_Eryn_tutorial_23_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_Eryn_tutorial_23_1.png" src="../_images/tutorial_Eryn_tutorial_23_1.png" />
</div>
</div>
<p>Now we will plot the chains.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#### Chains</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">ndim</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ndim</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">walk</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nwalkers</span><span class="p">):</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ensemble</span><span class="o">.</span><span class="n">get_chain</span><span class="p">()[</span><span class="s1">&#39;model_0&#39;</span><span class="p">][:,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">walk</span><span class="p">,</span> <span class="p">:,</span> <span class="n">i</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_Eryn_tutorial_25_0.png" src="../_images/tutorial_Eryn_tutorial_25_0.png" />
</div>
</div>
</section>
<section id="Backend-Objects">
<h2>Backend Objects<a class="headerlink" href="#Backend-Objects" title="Permalink to this headline">¶</a></h2>
<p>Backends are where all of the information in the sampler is stored as it runs. It is from these backends that samples are retrieved for plotting. You can find the documentation for the Backend objects <a class="reference external" href="https://mikekatz04.github.io/Eryn/html/user/backend.html#backends">here</a>. Here, we will go through the most commonly used functions from the backend: * <code class="docutils literal notranslate"><span class="pre">get_chain</span></code>: retrieve all of the samples stored over the course of the sampling run. * <code class="docutils literal notranslate"><span class="pre">get_log_like</span></code>: retrieve the log of the Likelihood
for each sample. * <code class="docutils literal notranslate"><span class="pre">get_log_prior</span></code>: retrieve the log of the prior for each sample. * <code class="docutils literal notranslate"><span class="pre">get_a_sample</span></code>: retrieve a state object from a specific iteration. <code class="docutils literal notranslate"><span class="pre">get_last_sample</span></code> may be more common. It is just a specific example of <code class="docutils literal notranslate"><span class="pre">get_a_sample</span></code> for the last sample.</p>
<p>Many (but not all) of the methods from the backend object are also raised to the level of sampler. So you can either call <code class="docutils literal notranslate"><span class="pre">EnsembleSampler.backend.method</span></code> or <code class="docutils literal notranslate"><span class="pre">EnsembleSampler.method</span></code> and it will be equivalent.</p>
<p>Common properties to get from the backend: * <code class="docutils literal notranslate"><span class="pre">shape</span></code>: returns a dictionary with keys for each branch name and values as tuples representing the specific shape for each model (this shape will not include the <code class="docutils literal notranslate"><span class="pre">nsteps</span></code> outer dimension. * <code class="docutils literal notranslate"><span class="pre">iteration</span></code>: number of stored iterations in the backend.</p>
<p>Now we will get the likelihood and prior. Notice the shape of the Likelihood is <code class="docutils literal notranslate"><span class="pre">(nsteps,</span> <span class="pre">ntemps,</span> <span class="pre">nwalkers)</span></code> (in this example we have 1 temperature). This will always be the shape of quantities that are a single value per walker (e.g. Likelihood, prior, posterior).</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">ll</span> <span class="o">=</span> <span class="n">ensemble</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">get_log_like</span><span class="p">()</span>
<span class="n">lp</span> <span class="o">=</span> <span class="n">ensemble</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">get_log_prior</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of iterations </span><span class="si">{</span><span class="n">ensemble</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">iteration</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="c1"># equivalent to ensemble.get_log_like() and ensemble.get_log_prior()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ll</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">ll</span><span class="p">,</span> <span class="n">lp</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Number of iterations 5000
(5000, 1, 100) [[[-1.98224284 -0.87039638 -1.54470588 ... -2.98792551 -3.13411122
   -0.49574469]]

 [[-0.57952899 -2.37451334 -3.67889333 ... -3.08409154 -3.32105535
   -3.20759563]]

 [[-4.45414793 -2.12120492 -3.21444427 ... -1.57862012 -1.83809883
   -0.81767746]]

 ...

 [[-1.65695824 -2.9144867  -0.54879307 ... -4.07328331 -2.03831224
   -1.66458118]]

 [[-0.7686407  -2.60406829 -0.6791302  ... -1.34366294 -2.50960982
   -1.72462757]]

 [[-1.42749033 -1.16465795 -2.90248791 ... -1.15985077 -0.99315444
   -4.36850174]]] [[[-11.51292546 -11.51292546 -11.51292546 ... -11.51292546 -11.51292546
   -11.51292546]]

 [[-11.51292546 -11.51292546 -11.51292546 ... -11.51292546 -11.51292546
   -11.51292546]]

 [[-11.51292546 -11.51292546 -11.51292546 ... -11.51292546 -11.51292546
   -11.51292546]]

 ...

 [[-11.51292546 -11.51292546 -11.51292546 ... -11.51292546 -11.51292546
   -11.51292546]]

 [[-11.51292546 -11.51292546 -11.51292546 ... -11.51292546 -11.51292546
   -11.51292546]]

 [[-11.51292546 -11.51292546 -11.51292546 ... -11.51292546 -11.51292546
   -11.51292546]]]
</pre></div></div>
</div>
<section id="5-dimensional-Arrays">
<h3>5-dimensional Arrays<a class="headerlink" href="#5-dimensional-Arrays" title="Permalink to this headline">¶</a></h3>
<p>The chain information is returned as a dictionary with keys as the branch names and values as 5-dimensional arrays: <code class="docutils literal notranslate"><span class="pre">(nsteps,</span> <span class="pre">ntemps,</span> <span class="pre">nwalkers,</span> <span class="pre">nleaves_max,</span> <span class="pre">ndim)</span></code>. For clarity: * nsteps: number of sampler iterations stored (time evolution of each forest) * ntemps: number of temperatures (which forest you are in) * nwalkers: number of walkers (which tree) * nleaves_max: maximum number of model counts or leaves for each specific branch. * ndim: number of parameters describing a single
model or leaf.</p>
<p>In our simple example, we have 1 temperature and our maximum leaf count is 1.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># getting the chain</span>
<span class="n">samples</span> <span class="o">=</span> <span class="n">ensemble</span><span class="o">.</span><span class="n">get_chain</span><span class="p">()</span>

<span class="c1"># same as</span>
<span class="c1"># samples = enseble.backend.get_chain()</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">samples</span><span class="p">),</span> <span class="n">samples</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">samples</span><span class="p">[</span><span class="s2">&quot;model_0&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;class &#39;dict&#39;&gt; dict_keys([&#39;model_0&#39;]) (5000, 1, 100, 1, 5)
</pre></div></div>
</div>
<p>We can also get the shape information direct from the backend:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">ensemble</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;model_0&#39;: (1, 100, 1, 5)}
</pre></div></div>
</div>
</section>
</section>
<section id="State-Objects">
<h2>State Objects<a class="headerlink" href="#State-Objects" title="Permalink to this headline">¶</a></h2>
<p>Now, we are going to look at <code class="docutils literal notranslate"><span class="pre">`State</span></code> &lt;<a class="reference external" href="https://mikekatz04.github.io/Eryn/build/html/user/state.html#eryn.state.State">https://mikekatz04.github.io/Eryn/build/html/user/state.html#eryn.state.State</a>&gt;`__ objects. They carry the current information throughout the sampler about the current state of the sampler. In our simple example, we can examine the current coordinates, likelihood, and prior values.</p>
<p>Output from the sampler above is the last state of the sampler <code class="docutils literal notranslate"><span class="pre">out</span></code>. This will include any additional objects passed through the sampler like <code class="docutils literal notranslate"><span class="pre">BranchSupplimental</span></code> objects that we will explain below.</p>
<p>Another way to retrieve the last state is from the backend. That is what we will do here. However, please note, that supplimental information (discussed below) is not stored in the backend, so the state that is returned from the backend will have information that is stored in the backend, but not supplimental information that was passed through the sampler at runtime.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">last_state</span> <span class="o">=</span> <span class="n">ensemble</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">get_last_sample</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">last_state</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;class &#39;eryn.state.State&#39;&gt;
</pre></div></div>
</div>
<p>We can access the Likelihood and prior values as <code class="docutils literal notranslate"><span class="pre">State.log_like</span></code> and <code class="docutils literal notranslate"><span class="pre">State.log_prior</span></code>. We can also ask the state to give use the posterior probability with the <code class="docutils literal notranslate"><span class="pre">get_log_prob</span></code> method. Note that shape of these values is <code class="docutils literal notranslate"><span class="pre">(ntemps,</span> <span class="pre">nwalkers)</span></code>. This is because <code class="docutils literal notranslate"><span class="pre">State</span></code> objects represent one moment in time in the sample, so they do not have the <code class="docutils literal notranslate"><span class="pre">nsteps</span></code> outer dimension that the backend has.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="nb">print</span><span class="p">(</span><span class="n">out</span><span class="o">.</span><span class="n">log_like</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">out</span><span class="o">.</span><span class="n">log_like</span><span class="p">,</span> <span class="n">out</span><span class="o">.</span><span class="n">log_prior</span><span class="p">,</span> <span class="n">out</span><span class="o">.</span><span class="n">get_log_prob</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(1, 100) [[-1.42749033 -1.16465795 -2.90248791 -1.4205464  -1.73184035 -0.39578371
  -0.89928881 -2.73063453 -5.05698648 -2.65102226 -3.12556428 -3.50663567
  -5.04791932 -1.76103745 -1.07386527 -6.57840323 -2.29057934 -1.66957024
  -4.51852613 -3.70260834 -2.36119413 -2.36890755 -1.98874125 -1.16826178
  -2.15226652 -4.44816169 -1.32793447 -1.56123251 -2.89421365 -0.96710328
  -1.37154053 -0.82806745 -1.37880472 -2.89903568 -1.54171462 -0.91201418
  -3.27744205 -1.41227693 -2.87390058 -2.58689758 -1.63521366 -3.49999803
  -1.00876715 -2.06648643 -2.60836479 -3.59342617 -1.27191883 -0.41782896
  -2.1558409  -1.41475221 -1.14262253 -3.28587146 -1.01802268 -3.5767039
  -2.37317013 -2.71393723 -4.17813968 -6.19328376 -2.31916484 -2.57155503
  -0.95290218 -0.61869495 -1.80460387 -0.44283864 -1.50356618 -4.04067114
  -0.36193275 -0.91386406 -2.14068647 -2.02976    -1.47348934 -1.24412132
  -2.41360504 -1.39083394 -2.72885983 -3.00367995 -2.01058413 -3.41718136
  -1.51099598 -1.40174721 -2.89822354 -3.29969113 -2.99498631 -0.34138926
  -2.2302706  -3.74844506 -2.9570999  -0.87762859 -5.92761277 -1.22958784
  -0.66157298 -1.34829214 -1.68768024 -1.30222919 -0.96393602 -1.90434747
  -1.86802227 -1.15985077 -0.99315444 -4.36850174]] [[-11.51292546 -11.51292546 -11.51292546 -11.51292546 -11.51292546
  -11.51292546 -11.51292546 -11.51292546 -11.51292546 -11.51292546
  -11.51292546 -11.51292546 -11.51292546 -11.51292546 -11.51292546
  -11.51292546 -11.51292546 -11.51292546 -11.51292546 -11.51292546
  -11.51292546 -11.51292546 -11.51292546 -11.51292546 -11.51292546
  -11.51292546 -11.51292546 -11.51292546 -11.51292546 -11.51292546
  -11.51292546 -11.51292546 -11.51292546 -11.51292546 -11.51292546
  -11.51292546 -11.51292546 -11.51292546 -11.51292546 -11.51292546
  -11.51292546 -11.51292546 -11.51292546 -11.51292546 -11.51292546
  -11.51292546 -11.51292546 -11.51292546 -11.51292546 -11.51292546
  -11.51292546 -11.51292546 -11.51292546 -11.51292546 -11.51292546
  -11.51292546 -11.51292546 -11.51292546 -11.51292546 -11.51292546
  -11.51292546 -11.51292546 -11.51292546 -11.51292546 -11.51292546
  -11.51292546 -11.51292546 -11.51292546 -11.51292546 -11.51292546
  -11.51292546 -11.51292546 -11.51292546 -11.51292546 -11.51292546
  -11.51292546 -11.51292546 -11.51292546 -11.51292546 -11.51292546
  -11.51292546 -11.51292546 -11.51292546 -11.51292546 -11.51292546
  -11.51292546 -11.51292546 -11.51292546 -11.51292546 -11.51292546
  -11.51292546 -11.51292546 -11.51292546 -11.51292546 -11.51292546
  -11.51292546 -11.51292546 -11.51292546 -11.51292546 -11.51292546]] [[-12.940415792342908 -12.677583417587554 -14.415413377625214
  -12.93347186157067 -13.244765815974956 -11.90870917107719
  -12.412214273918567 -14.243559994626837 -16.569911943376745
  -14.163947725995179 -14.638489746892098 -15.019561133785865
  -16.560844781047933 -13.273962917169325 -12.586790731616567
  -18.091328694187993 -13.803504807517804 -13.182495707716285
  -16.031451593689045 -15.215533802332814 -13.874119597520234
  -13.881833016685786 -13.501666712269909 -12.68118724623478
  -13.665191986574257 -15.961087157977811 -12.84085993067434
  -13.074157970517579 -14.407139117892207 -12.480028744896691
  -12.88446599707569 -12.340992915495912 -12.891730189936121
  -14.411961147899472 -13.054640088266552 -12.424939640090003
  -14.790367511483751 -12.92520239671439 -14.38682604744076
  -14.09982304339284 -13.148139120578165 -15.012923497905973
  -12.52169261110424 -13.579411893178353 -14.121290250868226
  -15.106351639206181 -12.784844298390535 -11.930754423765535
  -13.668766361316992 -12.927677676095627 -12.655547999705611
  -14.79879692762421 -12.530948142867862 -15.089629364057462
  -13.886095599419718 -14.226862691870274 -15.69106514237642
  -17.70620922875206 -13.832090303519264 -14.084480493540239
  -12.465827644649963 -12.131620415821978 -13.317529334503991
  -11.955764104187088 -13.016491649047339 -15.553596604052785
  -11.874858218944018 -12.426789524988834 -13.653611935171906
  -13.542685464914193 -12.98641480424607 -12.757046780762286
  -13.9265305036547 -12.903759408126696 -14.241785299801581
  -14.516605417919196 -13.52350959205911 -14.930106827649517
  -13.023921443712878 -12.914672671465087 -14.411149000980558
  -14.812616599091513 -14.50791177258283 -11.854314729318858
  -13.743196062451103 -15.261370525621608 -14.47002536748588
  -12.390554059324838 -17.440538231514108 -12.742513302541665
  -12.174498443983364 -12.861217600530411 -13.20060570040374
  -12.815154655047058 -12.47686148478496 -13.417272933845995
  -13.380947730905843 -12.672776233075945 -12.506079906842217
  -15.88142720644883]]
</pre></div></div>
</div>
<section id="Branches">
<h3>Branches<a class="headerlink" href="#Branches" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">State</span></code> objects store quantities at are single values per walker directly in the state as shown above (e.g. <code class="docutils literal notranslate"><span class="pre">State.log_like</span></code>). Information that gets down to the individual branch (or model type) level is stored in a <code class="docutils literal notranslate"><span class="pre">`Branch</span></code> &lt;<a class="reference external" href="https://mikekatz04.github.io/Eryn/html/user/state.html#eryn.state.Branch">https://mikekatz04.github.io/Eryn/html/user/state.html#eryn.state.Branch</a>&gt;`__ object. These <code class="docutils literal notranslate"><span class="pre">Branch</span></code> objects are stored in a dictionary within the <code class="docutils literal notranslate"><span class="pre">State</span></code> object with keys as branch names and values as the <code class="docutils literal notranslate"><span class="pre">Branch</span></code> object associated with that branch name. The
branch objects can be accessed as <code class="docutils literal notranslate"><span class="pre">state.branches[model_name]</span></code>. With in the branch object, the coordinates are stored. A few other things are stored, but we will get to that later. If you want a dictionary with keys at the branch names and values as the current coordinates, you can also use the property: <code class="docutils literal notranslate"><span class="pre">state.branches_coords</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">last_state</span><span class="o">.</span><span class="n">branches</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;model_0&#39;: &lt;eryn.state.Branch at 0x15d71c2e0&gt;}
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">last_state</span><span class="o">.</span><span class="n">branches</span><span class="p">[</span><span class="s2">&quot;model_0&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">coords</span>

<span class="c1"># same as</span>
<span class="c1"># last_state.branches_coords[&quot;model_0&quot;]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([[[[-3.00415560e-01,  9.66854202e-01, -7.44153080e-01,
           2.49559460e-01, -1.10176239e+00]],

        [[-8.65303628e-01, -8.52344609e-01,  3.00482271e-01,
          -7.84765063e-01, -3.84614619e-01]],

        [[ 1.50532498e+00,  1.73707929e+00, -3.96257858e-01,
          -5.42637175e-01,  2.64674677e-01]],

        [[-8.65566175e-01, -1.00097592e-01, -2.54061448e-01,
          -4.36691708e-01,  1.35152565e+00]],

        [[-4.91294554e-01, -4.13623880e-01,  1.42897010e+00,
          -1.87007244e-01, -9.87065548e-01]],

        [[ 5.37080250e-01,  5.56235339e-01, -9.69168630e-02,
           2.68460812e-01,  3.35037878e-01]],

        [[ 1.11414756e+00, -4.08860179e-01, -4.39117565e-01,
           4.43204876e-01, -2.88337251e-02]],

        [[-2.18385428e+00,  4.36452428e-01,  4.02163329e-01,
           5.44740263e-01,  2.07560868e-01]],

        [[-2.04215974e+00, -8.33093842e-01, -6.25046956e-01,
          -1.31236427e-01,  2.20036463e+00]],

        [[ 9.66081209e-01, -3.34844668e-01, -9.54626701e-01,
          -1.77611443e+00, -4.36710487e-01]],

        [[ 9.97569595e-01, -1.48740317e+00,  1.40723888e+00,
          -4.69279256e-01,  9.18188976e-01]],

        [[-4.19843966e-01, -3.84186827e-01, -9.95793077e-01,
          -3.05854840e-01,  2.36733011e+00]],

        [[-1.26228231e+00, -2.30521084e+00,  5.12410863e-01,
          -1.60387058e-01,  1.70299620e+00]],

        [[-1.38059281e+00, -1.65424314e-01,  7.55307482e-01,
          -8.99907005e-01,  4.56455013e-01]],

        [[ 1.86666104e-01,  9.00026281e-01,  2.44463918e-01,
          -8.57115442e-01, -7.13042429e-01]],

        [[-1.50486480e+00, -4.90749833e-02, -3.08112787e+00,
          -3.05006891e-01, -1.14166627e+00]],

        [[ 1.38875939e+00, -4.75999949e-01, -1.52280154e-01,
          -1.28243151e+00,  8.70695272e-01]],

        [[-4.41640478e-01,  3.06326342e-01, -3.95749449e-01,
          -7.87487471e-01, -1.50781438e+00]],

        [[-7.84964814e-01,  4.18407121e-01, -4.54418055e-01,
           4.49837495e-01, -2.79945860e+00]],

        [[ 4.29590469e-01,  3.57597411e-01,  1.97152762e+00,
           6.12498597e-01,  1.68247351e+00]],

        [[ 1.30483085e+00,  7.49480290e-01, -1.48555904e+00,
          -2.07347146e-01,  4.56295447e-01]],

        [[-1.53612124e+00,  1.94556930e-01,  8.95414781e-01,
          -1.14056851e+00, -4.87473166e-01]],

        [[-1.15501546e+00, -5.97964494e-01, -1.78744552e-01,
           7.36173333e-01,  1.30841869e+00]],

        [[-3.55661849e-01,  6.41832592e-01, -8.82581464e-01,
          -5.96815438e-01, -8.14211539e-01]],

        [[-1.40670658e-01, -8.96208106e-01, -5.65670296e-01,
          -1.08589100e+00,  1.40798214e+00]],

        [[-6.60036471e-01, -2.56129283e+00,  3.65051109e-02,
          -3.72681229e-01,  1.32673673e+00]],

        [[-1.45356024e+00, -4.57436964e-01, -5.44352536e-01,
          -2.59231145e-02,  1.91810552e-01]],

        [[ 2.53715795e-01,  1.55018151e+00, -5.22405636e-01,
          -5.91881105e-01, -1.78324748e-01]],

        [[-9.18580746e-01, -1.53631102e+00, -4.73332502e-01,
          -1.45852593e+00,  4.82745909e-01]],

        [[-5.55137581e-01,  9.79701615e-01, -5.47425172e-01,
           6.05405402e-01,  4.85304034e-03]],

        [[-7.00258333e-01, -2.47870467e-01,  3.02709970e-01,
           3.85207711e-01,  1.39687553e+00]],

        [[ 3.36858886e-01,  4.87112496e-01, -4.10823517e-01,
           1.06585299e+00, -2.37454450e-02]],

        [[-1.03633357e+00,  9.07910579e-01, -1.75540473e-01,
          -4.63802524e-01, -7.83194304e-01]],

        [[-9.94403540e-01,  1.56254115e+00, -1.42901573e+00,
           3.26946041e-01, -4.67673435e-01]],

        [[ 7.04059893e-01, -1.09745472e+00,  1.10973523e+00,
           3.89614626e-01, -3.19536688e-03]],

        [[-6.42716838e-01, -1.16281208e-01, -4.22701791e-01,
           1.03778888e+00,  3.76483102e-01]],

        [[ 8.43812414e-01,  5.38359060e-01, -7.71644594e-01,
          -2.20067486e+00,  3.38569061e-01]],

        [[ 2.65195416e-01, -1.25413546e-01, -1.48045115e+00,
           4.35620898e-01,  5.97491026e-01]],

        [[ 1.23871748e+00, -1.50953938e+00, -7.00703721e-01,
          -1.16660783e+00, -2.87596070e-01]],

        [[-1.29462806e+00,  1.57556691e-02,  1.04060127e+00,
          -1.04528463e+00, -1.14978873e+00]],

        [[ 1.15281855e+00,  9.67456339e-01,  8.89508388e-01,
           4.04079497e-01, -2.25742146e-01]],

        [[ 6.58509213e-01, -6.87687523e-01, -4.02063511e-01,
           2.03664105e+00, -1.33562185e+00]],

        [[-2.74332232e-01,  1.08972065e+00, -7.13371456e-01,
           9.91101626e-02,  4.85863536e-01]],

        [[-1.31265924e+00, -5.82939756e-01, -3.19386850e-01,
          -1.08863681e+00, -8.84839953e-01]],

        [[-1.45721127e+00,  1.78111484e-01,  1.68093794e+00,
          -3.62558857e-01,  3.23326314e-01]],

        [[-1.71591169e+00,  1.40379189e+00,  5.41024269e-01,
           1.24177881e+00,  6.61170064e-01]],

        [[ 1.54904343e-01,  1.42713757e+00,  1.35281147e-01,
           6.78421980e-01,  6.75521793e-02]],

        [[ 5.64552551e-01,  8.12460226e-02,  4.97937541e-01,
          -4.53817613e-01, -2.37581981e-01]],

        [[-1.10958692e-01, -1.33177716e+00, -1.19343427e-01,
          -9.73546847e-01, -1.25048120e+00]],

        [[ 6.32501712e-01,  2.80672811e-01, -1.09091644e+00,
          -9.11792147e-01, -5.73764047e-01]],

        [[-8.29215180e-02, -3.64392983e-01,  3.00063231e-01,
          -1.17814274e+00, -8.17024221e-01]],

        [[ 3.61644556e-01,  1.89453358e+00, -1.50706229e+00,
           5.54549567e-01,  5.22433442e-01]],

        [[-6.10984693e-01,  3.14912896e-01, -4.00285306e-01,
          -9.68532718e-01,  6.82120940e-01]],

        [[-2.11517276e+00, -2.36174025e-01,  1.75942469e-02,
           2.37462063e-01, -1.60217853e+00]],

        [[ 4.62601177e-01, -6.08135768e-02,  1.54922170e-01,
          -1.51353046e+00, -1.48790685e+00]],

        [[-1.72695257e+00, -6.72011715e-01, -1.26271186e+00,
           6.23188655e-01, -1.05376380e-01]],

        [[ 4.53745416e-01,  1.12334172e-01,  1.36300343e+00,
          -2.38400800e+00, -7.72336054e-01]],

        [[ 1.63480192e+00,  8.63646272e-01, -1.10021514e+00,
          -6.46514840e-02, -2.78450214e+00]],

        [[-1.26194204e+00,  1.42023976e+00,  3.49580213e-01,
          -3.08661847e-01, -9.00706674e-01]],

        [[-9.78378529e-01, -3.06272549e-01,  2.00532314e+00,
           1.96111186e-01, -1.79727959e-01]],

        [[ 7.16434755e-01, -2.54678572e-01,  8.62355907e-01,
          -7.03992104e-01, -2.97324458e-01]],

        [[-1.86154871e-02,  2.72798687e-01, -3.67401841e-01,
          -4.02376155e-01, -9.30448042e-01]],

        [[-1.04878307e+00,  3.69878716e-01, -1.36789564e+00,
          -6.80906615e-01,  1.94111450e-01]],

        [[ 2.68644826e-01,  1.01108023e-01, -2.61110872e-01,
          -8.56824020e-01, -3.09534213e-02]],

        [[ 7.90179795e-01, -2.54953756e-01, -1.34037492e-01,
           1.50582934e+00, -1.79607325e-01]],

        [[ 6.08848445e-01,  1.19062177e+00,  8.73358479e-01,
           2.33859098e+00, -2.47594118e-01]],

        [[ 5.18439675e-02, -6.61667049e-01, -1.13018535e-01,
           1.65164536e-01,  4.93276711e-01]],

        [[-5.40303641e-01,  7.27171867e-01,  6.91210565e-01,
           2.54496012e-01,  6.81528360e-01]],

        [[ 1.21488830e+00,  9.58975145e-01,  1.21887609e+00,
           1.48455941e-01, -6.14888562e-01]],

        [[-9.13478289e-01,  1.64060102e+00, -2.33440712e-01,
          -3.31649850e-01, -6.07469773e-01]],

        [[-1.13670751e+00, -2.69673968e-03, -1.26688858e+00,
          -1.45745957e-01,  1.69171179e-01]],

        [[ 2.34650033e-01, -5.10014032e-01,  1.29826609e+00,
          -4.21314491e-01,  5.56836555e-01]],

        [[-3.33895792e-01,  1.49429204e+00,  8.60136904e-01,
          -1.29549056e+00, -2.54329909e-01]],

        [[-1.57518916e+00, -4.22690258e-01,  3.04713997e-01,
           1.43575471e-01, -9.11889261e-02]],

        [[ 1.42192762e+00, -9.24798388e-01, -1.37528127e-01,
          -1.57107736e+00, -3.05600067e-01]],

        [[-1.53854951e+00, -6.61710802e-01,  1.14150032e+00,
           1.31425561e+00,  4.14817250e-01]],

        [[-7.70172149e-01, -2.99103348e-01,  2.55089779e-01,
          -1.40363561e+00, -1.14161140e+00]],

        [[ 6.26084660e-02,  2.25203441e+00, -2.95339326e-01,
           2.98143929e-02, -1.29254389e+00]],

        [[ 3.36071478e-02,  2.24003121e-01, -7.84665032e-02,
          -1.00909333e+00,  1.39508379e+00]],

        [[ 1.57135053e-02,  5.44913973e-01,  5.23552810e-01,
           1.08094846e+00, -1.03138700e+00]],

        [[ 7.17174875e-02,  1.65166407e+00,  6.86581688e-01,
           1.24684366e+00,  1.01847727e+00]],

        [[ 1.04208485e+00, -2.31835559e-01, -2.42558724e-01,
          -2.26592292e+00, -5.16190162e-01]],

        [[ 4.01241694e-01, -1.31928203e+00, -1.25023728e+00,
          -6.54337985e-01,  1.44817858e+00]],

        [[ 4.89179863e-02,  7.44450907e-02, -9.72793781e-02,
          -7.79310472e-01, -2.40946880e-01]],

        [[-1.09968137e-01, -9.15533553e-02,  4.27929940e-01,
           1.33794112e-02,  2.06319246e+00]],

        [[ 4.07575079e-01, -9.20335266e-01, -1.03577586e+00,
          -7.62230778e-01, -2.19770978e+00]],

        [[ 4.71774549e-01,  7.74178442e-01,  1.33041159e+00,
           1.76852353e+00,  4.41141519e-01]],

        [[-8.50621043e-01,  7.33459070e-01, -2.55754487e-02,
           3.34325987e-01,  6.17503726e-01]],

        [[ 2.12605565e+00,  2.07694498e+00, -9.08787783e-01,
           1.24009313e+00, -8.10978567e-01]],

        [[ 4.40473933e-01,  2.22869255e-01, -8.59904094e-01,
          -6.89927933e-01,  1.00002604e+00]],

        [[-1.04399089e+00,  2.65234979e-01, -1.02352829e-02,
           1.84357791e-01,  3.58868816e-01]],

        [[-1.52422088e+00,  1.51925979e-01,  4.09692897e-01,
          -2.62434324e-03, -4.27081148e-01]],

        [[ 1.85767035e-01,  4.88179242e-01,  1.64979008e+00,
          -5.04126971e-01,  3.55781954e-01]],

        [[-1.23857666e-01, -1.07454392e+00,  1.00688638e+00,
           4.62451441e-01, -4.54743336e-01]],

        [[-8.76415573e-02,  1.62180258e-01, -1.03643200e+00,
           7.15035841e-01,  5.55356652e-01]],

        [[-1.28548770e+00, -6.01580704e-01, -2.72362700e-01,
           1.22669034e+00, -4.64075808e-01]],

        [[-9.59146697e-01,  1.35463298e+00, -7.03817896e-01,
           1.78083975e-01, -6.73778969e-01]],

        [[ 8.81762563e-01,  6.55363121e-01,  6.66444778e-01,
          -5.26641287e-01,  6.25456481e-01]],

        [[ 1.14940660e+00,  5.03617341e-02,  2.85808466e-01,
           4.76878304e-01, -5.94590313e-01]],

        [[ 2.24699687e-01,  2.90533996e-01,  2.14435207e+00,
           1.12572491e+00, -1.65426755e+00]]]])
</pre></div></div>
</div>
</section>
</section>
<section id="Parallel-Tempering">
<h2>Parallel Tempering<a class="headerlink" href="#Parallel-Tempering" title="Permalink to this headline">¶</a></h2>
<p>Adding tempering to our problem is straight forward. It will effectively just take the <code class="docutils literal notranslate"><span class="pre">ntemps</span></code> dimension that was 1 above and stretch it to the number of temperatures desired. We add tempering information by providing the <code class="docutils literal notranslate"><span class="pre">tempering_kwargs</span></code> argument to the <code class="docutils literal notranslate"><span class="pre">EnsembleSampler</span></code>. The tempering kwargs documentation can be found here because they are the <code class="docutils literal notranslate"><span class="pre">kwargs</span></code> that go into the initialization of the temperature controller:
<code class="docutils literal notranslate"><span class="pre">`eryn.moves.tempering.TemperatureControl</span></code> &lt;<a class="reference external" href="https://mikekatz04.github.io/Eryn/html/user/temper.html#eryn.moves.tempering.TemperatureControl">https://mikekatz04.github.io/Eryn/html/user/temper.html#eryn.moves.tempering.TemperatureControl</a>&gt;`__.</p>
<p>The simplest thing to do is to provide the number of temperatures. In this case, we just pass <code class="docutils literal notranslate"><span class="pre">ntemps</span></code> in a dictionary. You can also provide a direct array of <code class="docutils literal notranslate"><span class="pre">betas</span></code> (inverse temperatures). Under the hood, if only <code class="docutils literal notranslate"><span class="pre">ntemps</span></code> is passed (not <code class="docutils literal notranslate"><span class="pre">betas</span></code>), the sampler will use the <code class="docutils literal notranslate"><span class="pre">`eryn.moves.tempering.make_ladder</span></code> &lt;<a class="reference external" href="https://mikekatz04.github.io/Eryn/html/user/temper.html#eryn.moves.tempering.make_ladder">https://mikekatz04.github.io/Eryn/html/user/temper.html#eryn.moves.tempering.make_ladder</a>&gt;`__ function. We will go all thr way through to the MCMC run. Notice that we are once
again just passing <code class="docutils literal notranslate"><span class="pre">coords</span></code> as an array to start the sampling. We could also pass a <code class="docutils literal notranslate"><span class="pre">State</span></code> object.</p>
<p>What does tempering actual do? The inverse temperature, <span class="math notranslate nohighlight">\(\beta=1/T\)</span>, is attached as an exponent on the Likelihood. The posterior probability as a function of inverse temperature is given by,</p>
<div class="math notranslate nohighlight">
\[\pi_\beta(\vec{\theta}, \mathcal{M})\propto (\mathcal{L}(\vec{\theta}, \mathcal{M}))^\beta p(\vec{\theta},\mathcal{M}).\]</div>
<p>If <span class="math notranslate nohighlight">\(T=1\rightarrow \beta=1\)</span>, we are probing our TARGET distribution.</p>
<p>If <span class="math notranslate nohighlight">\(T=\infty\rightarrow \beta=0\)</span>, we are probing the PRIOR distribution. In this case, the Likelihood surface is effectively flat.</p>
<p>Temperatures in between represent the gradual flattening of the target Likelihood surface towards the flat surface at infinite temperature. During sampling, we look at the log of the Likelihood, so the inverse temperature becomes a multiplicative factor:</p>
<div class="math notranslate nohighlight">
\[\ln\pi_\beta(\vec{\theta}, \mathcal{M})\propto\beta\ln\mathcal{L}(\vec{\theta}, \mathcal{M})\]</div>
<p>Tempering is useful for multimodal distributions and to improve mixing in your chains. This mixing is created by swapping between rungs on our temperature ladder. After each sampler step, swaps are proposed starting at the two highest temperatures and iterating down until we reach the two lowest temperatures. This ensures as higher temperature chains find better Likelihood values, these values and positions are passed toward the cold chain (<span class="math notranslate nohighlight">\(\beta=1\)</span>). The swaps between chains are accepted
with fraction, <span class="math notranslate nohighlight">\(\alpha_T\)</span>:</p>
<div class="math notranslate nohighlight">
\[\alpha_T = \min\left(1, \left[\frac{\mathcal{L_{\beta_1}}}{\mathcal{L_{\beta_2}}}\right]^{\beta_1 - \beta_2}\right).\]</div>
<p>We can see from this how swapping is similar to the Metropolis-Hastings acceptance setup.If <span class="math notranslate nohighlight">\(\beta_1 &gt; \beta_2\)</span> (or <span class="math notranslate nohighlight">\(T_1 &lt;T_2\)</span>), the exponent is positive. In this case, if <span class="math notranslate nohighlight">\(\mathcal{L_{\beta_1}} &gt; \mathcal{L_{\beta_2}}\)</span>, the swap will always be accepted because we want the better likelihood to go to higher <span class="math notranslate nohighlight">\(\beta\)</span> (or lower <span class="math notranslate nohighlight">\(T\)</span>). If <span class="math notranslate nohighlight">\(\mathcal{L_{\beta_1}} &lt; \mathcal{L_{\beta_2}}\)</span>, the swap is accepted with a probability that reflects difference in the
Likelihoods just like discussed above.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>

<span></span><span class="c1"># set up problem</span>
<span class="n">ndim</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">nwalkers</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">ntemps</span> <span class="o">=</span> <span class="mi">10</span>

<span class="c1"># fill kwargs dictionary</span>
<span class="n">tempering_kwargs</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">ntemps</span><span class="o">=</span><span class="n">ntemps</span><span class="p">)</span>

<span class="c1"># randomize throughout prior</span>
<span class="n">coords</span> <span class="o">=</span> <span class="n">priors</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">ntemps</span><span class="p">,</span> <span class="n">nwalkers</span><span class="p">,))</span>

<span class="c1"># initialize sampler</span>
<span class="n">ensemble_pt</span> <span class="o">=</span> <span class="n">EnsembleSampler</span><span class="p">(</span>
    <span class="n">nwalkers</span><span class="p">,</span>
    <span class="n">ndim</span><span class="p">,</span>
    <span class="n">log_like_fn</span><span class="p">,</span>
    <span class="n">priors</span><span class="p">,</span>
    <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">means</span><span class="p">,</span> <span class="n">cov</span><span class="p">],</span>
    <span class="n">tempering_kwargs</span><span class="o">=</span><span class="n">tempering_kwargs</span>
<span class="p">)</span>

<span class="n">nsteps</span> <span class="o">=</span> <span class="mi">500</span>
<span class="c1"># burn for 1000 steps</span>
<span class="n">burn</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="c1"># thin by 5</span>
<span class="n">thin_by</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">ensemble_pt</span><span class="o">.</span><span class="n">run_mcmc</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">nsteps</span><span class="p">,</span> <span class="n">burn</span><span class="o">=</span><span class="n">burn</span><span class="p">,</span> <span class="n">progress</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">thin_by</span><span class="o">=</span><span class="n">thin_by</span><span class="p">)</span>


</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|███████████████████████████████████████| 1000/1000 [00:16&lt;00:00, 59.61it/s]
100%|███████████████████████████████████████| 2500/2500 [00:42&lt;00:00, 58.73it/s]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;eryn.state.State at 0x15d71cd30&gt;
</pre></div></div>
</div>
<p>We can plot our samples at different temperatures and see the differences in action.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">for</span> <span class="n">temp</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ntemps</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">temp</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">samples</span> <span class="o">=</span> <span class="n">ensemble_pt</span><span class="o">.</span><span class="n">get_chain</span><span class="p">()[</span><span class="s1">&#39;model_0&#39;</span><span class="p">][:,</span> <span class="n">temp</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">ndim</span><span class="p">)</span>
    <span class="n">corner</span><span class="o">.</span><span class="n">corner</span><span class="p">(</span><span class="n">samples</span><span class="p">,</span> <span class="n">truths</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">ndim</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
1
2
3
4
5
6
7
8
9
10
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_Eryn_tutorial_49_1.png" src="../_images/tutorial_Eryn_tutorial_49_1.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_Eryn_tutorial_49_2.png" src="../_images/tutorial_Eryn_tutorial_49_2.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_Eryn_tutorial_49_3.png" src="../_images/tutorial_Eryn_tutorial_49_3.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_Eryn_tutorial_49_4.png" src="../_images/tutorial_Eryn_tutorial_49_4.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_Eryn_tutorial_49_5.png" src="../_images/tutorial_Eryn_tutorial_49_5.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_Eryn_tutorial_49_6.png" src="../_images/tutorial_Eryn_tutorial_49_6.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_Eryn_tutorial_49_7.png" src="../_images/tutorial_Eryn_tutorial_49_7.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_Eryn_tutorial_49_8.png" src="../_images/tutorial_Eryn_tutorial_49_8.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_Eryn_tutorial_49_9.png" src="../_images/tutorial_Eryn_tutorial_49_9.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_Eryn_tutorial_49_10.png" src="../_images/tutorial_Eryn_tutorial_49_10.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#### Chains</span>
<span class="k">for</span> <span class="n">temp</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ntemps</span><span class="p">):</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">ndim</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ndim</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">walk</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nwalkers</span><span class="p">):</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ensemble_pt</span><span class="o">.</span><span class="n">get_chain</span><span class="p">()[</span><span class="s1">&#39;model_0&#39;</span><span class="p">][:,</span> <span class="n">temp</span><span class="p">,</span> <span class="n">walk</span><span class="p">,</span> <span class="p">:,</span> <span class="n">i</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_Eryn_tutorial_50_0.png" src="../_images/tutorial_Eryn_tutorial_50_0.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_Eryn_tutorial_50_1.png" src="../_images/tutorial_Eryn_tutorial_50_1.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_Eryn_tutorial_50_2.png" src="../_images/tutorial_Eryn_tutorial_50_2.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_Eryn_tutorial_50_3.png" src="../_images/tutorial_Eryn_tutorial_50_3.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_Eryn_tutorial_50_4.png" src="../_images/tutorial_Eryn_tutorial_50_4.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_Eryn_tutorial_50_5.png" src="../_images/tutorial_Eryn_tutorial_50_5.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_Eryn_tutorial_50_6.png" src="../_images/tutorial_Eryn_tutorial_50_6.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_Eryn_tutorial_50_7.png" src="../_images/tutorial_Eryn_tutorial_50_7.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_Eryn_tutorial_50_8.png" src="../_images/tutorial_Eryn_tutorial_50_8.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_Eryn_tutorial_50_9.png" src="../_images/tutorial_Eryn_tutorial_50_9.png" />
</div>
</div>
<p>Likelihoods across temperatures:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">ll</span> <span class="o">=</span> <span class="n">ensemble_pt</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">get_log_like</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ll</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="c1"># cold chain and highest temperature chain</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ll</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;cold&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ll</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;warm&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(500, 10, 100)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.legend.Legend at 0x161a1c670&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_Eryn_tutorial_52_2.png" src="../_images/tutorial_Eryn_tutorial_52_2.png" />
</div>
</div>
</section>
<section id="Add-Reversible-Jump-MCMC-(model-count-uncertainty)">
<h2>Add Reversible Jump MCMC (model count uncertainty)<a class="headerlink" href="#Add-Reversible-Jump-MCMC-(model-count-uncertainty)" title="Permalink to this headline">¶</a></h2>
<p>We will now add to our sampler the ability to run with one branch, but a variable number of counts or leaves.</p>
<p>Here we are going to focus on the nested model case where we are just proposing changes in the model count. For more general review on Reversible Jump, see the Eryn paper and sources within.</p>
<p>In nested models, the acceptance probability for proposing to add a source is given by, <span class="math notranslate nohighlight">\(\alpha_\text{nested}\)</span>,</p>
<div class="math notranslate nohighlight">
\[\alpha_\text{nested} = \min\left(1, \frac{\mathcal{L}(\vec{\theta})_{k+1}}{\mathcal{L}(\vec{\theta})_{k}}\frac{p(\vec{\theta}_{+1})}{q(\vec{\theta}_{+1})}\right),\]</div>
<p>where there are <span class="math notranslate nohighlight">\(k\)</span> models to start, <span class="math notranslate nohighlight">\(p(\vec{\theta}_{+1})\)</span> is the prior probability of the added source only (the prior of the other sources cancels in the numerator and denominator), and <span class="math notranslate nohighlight">\(q(\vec{\theta}_{+1})\)</span> is the proposal distribution for the added source, <span class="math notranslate nohighlight">\(\mathcal{L}(\vec{\theta})_k\)</span> is the Likelihood for the position with <span class="math notranslate nohighlight">\(k\)</span> models, and <span class="math notranslate nohighlight">\(\mathcal{L}(\vec{\theta})_{k+1}\)</span> is the Likelihood for the position with <span class="math notranslate nohighlight">\(k + 1\)</span> models.</p>
<p>Reversible Jump proposals usually require specific implementations for each problem. We have one provided RJ proposal where we draw from the prior, which is the simplest and most generic reversible jump proposal for adding a nested model. In this case, the acceptance fraction just reduces to the Likelihood fraction.</p>
<p>For this example, we will look at a set of 1D Gaussian pulses. We will inject a specific number, and then allow the sampler to determine the posterior probability on the model count, as well as the posterior on the parameters.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">gaussian_pulse</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
    <span class="n">f_x</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">((</span><span class="n">x</span> <span class="o">-</span> <span class="n">b</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">c</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">f_x</span>

<span class="k">def</span> <span class="nf">combine_gaussians</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
    <span class="n">template</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
        <span class="n">template</span> <span class="o">+=</span> <span class="n">gaussian_pulse</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="o">*</span><span class="n">param</span><span class="p">)</span>  <span class="c1"># *params -&gt; a, b, c</span>
    <span class="k">return</span> <span class="n">template</span>

<span class="k">def</span> <span class="nf">log_like_fn_gauss_pulse</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">sigma</span><span class="p">):</span>

    <span class="n">template</span> <span class="o">=</span> <span class="n">combine_gaussians</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>

    <span class="n">ll</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(((</span><span class="n">template</span> <span class="o">-</span> <span class="n">data</span><span class="p">)</span> <span class="o">/</span> <span class="n">sigma</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ll</span>


<span class="n">nwalkers</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">ntemps</span> <span class="o">=</span> <span class="mi">8</span>
<span class="n">ndim</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">nleaves_max</span> <span class="o">=</span> <span class="mi">8</span>
<span class="n">nleaves_min</span> <span class="o">=</span> <span class="mi">0</span>

<span class="n">branch_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;gauss&quot;</span><span class="p">]</span>

<span class="c1"># define time stream</span>
<span class="n">num</span> <span class="o">=</span> <span class="mi">500</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">num</span><span class="p">)</span>

<span class="n">gauss_inj_params</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">[</span><span class="mf">3.3</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">2.6</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">3.4</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">2.9</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">],</span>
<span class="p">]</span>

<span class="c1"># combine gaussians</span>
<span class="n">injection</span> <span class="o">=</span> <span class="n">combine_gaussians</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">gauss_inj_params</span><span class="p">))</span>

<span class="c1"># set noise level</span>
<span class="n">sigma</span> <span class="o">=</span> <span class="mf">2.0</span>

<span class="c1"># produce full data</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">injection</span> <span class="o">+</span> <span class="n">sigma</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">injection</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;lightskyblue&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">injection</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;injection&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;crimson&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.legend.Legend at 0x1625c8490&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_Eryn_tutorial_56_1.png" src="../_images/tutorial_Eryn_tutorial_56_1.png" />
</div>
</div>
<p>The first thing we do is setup our <code class="docutils literal notranslate"><span class="pre">coords</span></code> array. We have seen <code class="docutils literal notranslate"><span class="pre">coords</span></code> before. That array is the same but now <code class="docutils literal notranslate"><span class="pre">nleaves_max</span> <span class="pre">&gt;</span> <span class="pre">1</span></code>.</p>
<p>We also need to setup our <code class="docutils literal notranslate"><span class="pre">inds</span></code> arrays. <code class="docutils literal notranslate"><span class="pre">inds</span></code> is only needed when the dimensionality is changing (or more generally when not all leaves are used). <code class="docutils literal notranslate"><span class="pre">inds</span></code> is a boolean array with shape <code class="docutils literal notranslate"><span class="pre">(ntemps,</span> <span class="pre">nwalkers,</span> <span class="pre">nleaves_max)</span></code>. It indicates which leaves are being used. This allows us to use the array structures while have a variable number of leaves per walker.</p>
<p>We are going to assume we have some knowledge of what is in the data, so we are going to start with 4 leaves for every walker. The burn-in will spread out the walkers both in terms of the parameters and in terms of the number of leaves per walker. Therefore, we are going to make the first four leaves in every walker <code class="docutils literal notranslate"><span class="pre">True</span></code> to indicate 4 binaries. We are going to then put coordinates near each of the true Gaussians into <code class="docutils literal notranslate"><span class="pre">coords</span></code>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">coords</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;gauss&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">ntemps</span><span class="p">,</span> <span class="n">nwalkers</span><span class="p">,</span> <span class="n">nleaves_max</span><span class="p">,</span> <span class="n">ndim</span><span class="p">))}</span>

<span class="c1"># this is the sigma for the multivariate Gaussian that sets starting points</span>
<span class="c1"># We need it to be very small to assume we are passed the search phase</span>
<span class="c1"># we will verify this is with likelihood calculations</span>
<span class="n">sig1</span> <span class="o">=</span> <span class="mf">0.0001</span>

<span class="c1"># setup initial walkers to be the correct count (it will spread out)</span>
<span class="k">for</span> <span class="n">nn</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nleaves_max</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">nn</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">gauss_inj_params</span><span class="p">):</span>
        <span class="c1"># not going to add parameters for these unused leaves</span>
        <span class="k">continue</span>

    <span class="n">coords</span><span class="p">[</span><span class="s2">&quot;gauss&quot;</span><span class="p">][:,</span> <span class="p">:,</span> <span class="n">nn</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">multivariate_normal</span><span class="p">(</span><span class="n">gauss_inj_params</span><span class="p">[</span><span class="n">nn</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="n">sig1</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">ntemps</span><span class="p">,</span> <span class="n">nwalkers</span><span class="p">))</span>

<span class="c1"># make sure to start near the proper setup</span>
<span class="n">inds</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;gauss&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">ntemps</span><span class="p">,</span> <span class="n">nwalkers</span><span class="p">,</span> <span class="n">nleaves_max</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)}</span>

<span class="c1"># turn False -&gt; True for any binary in the sampler</span>
<span class="n">inds</span><span class="p">[</span><span class="s1">&#39;gauss&#39;</span><span class="p">][:,</span> <span class="p">:,</span> <span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">gauss_inj_params</span><span class="p">)]</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div>
</div>
</div>
<p>Priors are defined per model for a single model. It will take into account multiple models by summing the prior probability over the leaves.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># describes priors for all leaves independently</span>
<span class="n">priors</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;gauss&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="mi">0</span><span class="p">:</span> <span class="n">uniform_dist</span><span class="p">(</span><span class="mf">2.5</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">),</span>  <span class="c1"># amplitude</span>
        <span class="mi">1</span><span class="p">:</span> <span class="n">uniform_dist</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">t</span><span class="o">.</span><span class="n">max</span><span class="p">()),</span>  <span class="c1"># mean</span>
        <span class="mi">2</span><span class="p">:</span> <span class="n">uniform_dist</span><span class="p">(</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.21</span><span class="p">),</span>  <span class="c1"># sigma</span>
    <span class="p">},</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<p>When reversible jump sampling is run, an RJ move (between model) is performed followed by an “in-model” move for each iteration of the sampler. “In-model” here means the model count is fixed, but the parameters are updated. We pass “in-model” moves to the sampler with the keyword argument <code class="docutils literal notranslate"><span class="pre">moves</span></code>. We pass RJ moves with the <code class="docutils literal notranslate"><span class="pre">rj_moves</span></code> keyword argument.</p>
<p>The stock proposal in <code class="docutils literal notranslate"><span class="pre">Eryn</span></code> is the stretch proposal. This proposal is only directly useful when the dimensionality is fixed. This will be discussed more below. When using reversible jump, we must choose our in-model proposal because the dimensionality is not fixed. Therefore, we choose to move our walkers with the most basic in-model move available: <code class="docutils literal notranslate"><span class="pre">`eryn.moves.GaussianMove</span></code> &lt;<a class="reference external" href="https://mikekatz04.github.io/Eryn/html/user/moves.html#eryn.moves.GaussianMove">https://mikekatz04.github.io/Eryn/html/user/moves.html#eryn.moves.GaussianMove</a>&gt;`__. For this move you can provide a
covariance matrix that will be used in a multivariate Gaussian to propose new points that are centered on the current points (the means of the multivariate Gaussian will be the current point). This proposal is symmetric.</p>
<p>In this case, we are going to use the stock RJ proposal: <code class="docutils literal notranslate"><span class="pre">`eryn.moves.PriorGenRj</span></code> &lt;<a class="reference external" href="https://mikekatz04.github.io/Eryn/html/user/moves.html#eryn.moves.PriorGenerateRJ">https://mikekatz04.github.io/Eryn/html/user/moves.html#eryn.moves.PriorGenerateRJ</a>&gt;`__. You can either pass this directly or you can set <code class="docutils literal notranslate"><span class="pre">rj_moves</span></code> to <code class="docutils literal notranslate"><span class="pre">True</span></code> (this is the default).</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># for the Gaussian Move, will be explained later</span>
<span class="n">factor</span> <span class="o">=</span> <span class="mf">0.00001</span>
<span class="n">cov</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;gauss&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">ndim</span><span class="p">))</span> <span class="o">*</span> <span class="n">factor</span><span class="p">}</span>

<span class="n">moves</span> <span class="o">=</span> <span class="n">GaussianMove</span><span class="p">(</span><span class="n">cov</span><span class="p">)</span>

</pre></div>
</div>
</div>
<p>We will now initialize the sampler by adding the branch, tempering, leaf, and move information.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">ensemble</span> <span class="o">=</span> <span class="n">EnsembleSampler</span><span class="p">(</span>
    <span class="n">nwalkers</span><span class="p">,</span>
    <span class="n">ndim</span><span class="p">,</span>
    <span class="n">log_like_fn_gauss_pulse</span><span class="p">,</span>
    <span class="n">priors</span><span class="p">,</span>
    <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">sigma</span><span class="p">],</span>
    <span class="n">tempering_kwargs</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">ntemps</span><span class="o">=</span><span class="n">ntemps</span><span class="p">),</span>
    <span class="n">nbranches</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">branch_names</span><span class="p">),</span>
    <span class="n">branch_names</span><span class="o">=</span><span class="n">branch_names</span><span class="p">,</span>
    <span class="n">nleaves_max</span><span class="o">=</span><span class="n">nleaves_max</span><span class="p">,</span>
    <span class="n">nleaves_min</span><span class="o">=</span><span class="n">nleaves_min</span><span class="p">,</span>
    <span class="n">moves</span><span class="o">=</span><span class="n">moves</span><span class="p">,</span>
    <span class="n">rj_moves</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># basic generation of new leaves from the prior</span>
<span class="p">)</span>


</pre></div>
</div>
</div>
<p>Now we will setup a <code class="docutils literal notranslate"><span class="pre">State</span></code> object and will use the Likelihood (<code class="docutils literal notranslate"><span class="pre">compute_log_like</span></code>) and prior functions (<code class="docutils literal notranslate"><span class="pre">compute_log_prior</span></code>) that are built into the sampler. The Likelihood function in the sampler will check the prior and only run walkers that exist entirely within the prior distribution. We can avoid redoing this computation by passing the prior as the <code class="docutils literal notranslate"><span class="pre">logp</span></code> kwarg to <code class="docutils literal notranslate"><span class="pre">compute_log_like</span></code>. The <code class="docutils literal notranslate"><span class="pre">[0]</span></code> at the end of the line is to grab the log Likelihood and leave behind any blobs.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>

<span></span><span class="n">log_prior</span> <span class="o">=</span> <span class="n">ensemble</span><span class="o">.</span><span class="n">compute_log_prior</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">inds</span><span class="o">=</span><span class="n">inds</span><span class="p">)</span>
<span class="n">log_like</span> <span class="o">=</span> <span class="n">ensemble</span><span class="o">.</span><span class="n">compute_log_like</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">inds</span><span class="o">=</span><span class="n">inds</span><span class="p">,</span> <span class="n">logp</span><span class="o">=</span><span class="n">log_prior</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># make sure it is reasonably close to the maximum which this is</span>
<span class="c1"># will not be zero due to noise</span>
<span class="nb">print</span><span class="p">(</span><span class="n">log_like</span><span class="p">,</span> <span class="n">log_prior</span><span class="p">)</span>

<span class="c1"># setup starting state</span>
<span class="n">state</span> <span class="o">=</span> <span class="n">State</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">log_like</span><span class="o">=</span><span class="n">log_like</span><span class="p">,</span> <span class="n">log_prior</span><span class="o">=</span><span class="n">log_prior</span><span class="p">,</span> <span class="n">inds</span><span class="o">=</span><span class="n">inds</span><span class="p">)</span>

</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[[-276.73098648 -278.16907507 -275.71434217 -276.61800004 -274.75928123
  -277.69176003 -275.98146339 -273.83652286 -274.65924818 -275.94893546
  -276.09577899 -274.87491752 -274.89522646 -277.96412044 -276.42046542
  -280.19171799 -274.87278656 -279.70015548 -278.72737909 -278.72827274]
 [-277.80825075 -278.12967818 -276.36568961 -276.30088806 -278.73533818
  -279.22516202 -276.70640669 -275.65262805 -273.76469604 -279.56741958
  -276.7064569  -276.43440397 -276.27134788 -276.44496003 -275.53182148
  -275.46582235 -280.41404972 -276.26268199 -281.76019484 -273.35791229]
 [-275.81230348 -283.40675493 -274.02139424 -277.8975312  -274.5771202
  -280.01900442 -277.19312704 -276.42934571 -275.50910806 -274.10550909
  -277.83673942 -282.5110014  -276.54751785 -274.29108684 -283.55959284
  -279.13211986 -278.70274453 -275.56266279 -275.15711238 -273.86514215]
 [-274.51669408 -278.06824089 -276.34514996 -279.24216524 -275.85623823
  -277.4116664  -276.97439327 -274.1028994  -281.9099354  -277.58748298
  -276.57170804 -276.20327499 -276.06449811 -276.55245489 -276.63010178
  -277.8547527  -279.65714237 -279.60258295 -280.85753756 -276.47640408]
 [-273.99762161 -273.79881606 -275.94816613 -273.69139951 -276.29586808
  -275.40596822 -278.39121379 -282.66793822 -273.84580381 -277.20981927
  -278.36298545 -281.08807608 -274.51959354 -276.56090434 -280.34821487
  -275.8274073  -275.86138763 -277.57526228 -274.56046513 -278.84539284]
 [-275.79381564 -276.05763367 -278.5669222  -274.72847425 -279.65677961
  -275.58609512 -273.34746775 -277.20300325 -274.23069486 -279.71149647
  -275.34041723 -274.98377029 -276.05259079 -274.85895311 -276.17007461
  -278.20181081 -279.23751121 -276.95063228 -274.66366606 -275.72836976]
 [-274.24415251 -276.57350865 -276.12350216 -273.0682653  -276.51465012
  -275.48161239 -274.0188211  -274.47052518 -277.46568838 -281.85703554
  -278.35727851 -275.40037889 -274.77744077 -274.97789592 -275.06201379
  -275.55218321 -281.30549804 -276.56424656 -276.54277054 -276.57012499]
 [-275.64188147 -277.90627179 -282.768205   -274.90755293 -277.88921013
  -276.39783498 -274.23204134 -278.16266963 -276.57890304 -278.80318237
  -276.33613686 -278.03182745 -275.47772264 -276.13888541 -276.8650892
  -279.62419937 -280.67345405 -279.30159972 -273.92424857 -279.07804469]] [[3.66516293 3.66516293 3.66516293 3.66516293 3.66516293 3.66516293
  3.66516293 3.66516293 3.66516293 3.66516293 3.66516293 3.66516293
  3.66516293 3.66516293 3.66516293 3.66516293 3.66516293 3.66516293
  3.66516293 3.66516293]
 [3.66516293 3.66516293 3.66516293 3.66516293 3.66516293 3.66516293
  3.66516293 3.66516293 3.66516293 3.66516293 3.66516293 3.66516293
  3.66516293 3.66516293 3.66516293 3.66516293 3.66516293 3.66516293
  3.66516293 3.66516293]
 [3.66516293 3.66516293 3.66516293 3.66516293 3.66516293 3.66516293
  3.66516293 3.66516293 3.66516293 3.66516293 3.66516293 3.66516293
  3.66516293 3.66516293 3.66516293 3.66516293 3.66516293 3.66516293
  3.66516293 3.66516293]
 [3.66516293 3.66516293 3.66516293 3.66516293 3.66516293 3.66516293
  3.66516293 3.66516293 3.66516293 3.66516293 3.66516293 3.66516293
  3.66516293 3.66516293 3.66516293 3.66516293 3.66516293 3.66516293
  3.66516293 3.66516293]
 [3.66516293 3.66516293 3.66516293 3.66516293 3.66516293 3.66516293
  3.66516293 3.66516293 3.66516293 3.66516293 3.66516293 3.66516293
  3.66516293 3.66516293 3.66516293 3.66516293 3.66516293 3.66516293
  3.66516293 3.66516293]
 [3.66516293 3.66516293 3.66516293 3.66516293 3.66516293 3.66516293
  3.66516293 3.66516293 3.66516293 3.66516293 3.66516293 3.66516293
  3.66516293 3.66516293 3.66516293 3.66516293 3.66516293 3.66516293
  3.66516293 3.66516293]
 [3.66516293 3.66516293 3.66516293 3.66516293 3.66516293 3.66516293
  3.66516293 3.66516293 3.66516293 3.66516293 3.66516293 3.66516293
  3.66516293 3.66516293 3.66516293 3.66516293 3.66516293 3.66516293
  3.66516293 3.66516293]
 [3.66516293 3.66516293 3.66516293 3.66516293 3.66516293 3.66516293
  3.66516293 3.66516293 3.66516293 3.66516293 3.66516293 3.66516293
  3.66516293 3.66516293 3.66516293 3.66516293 3.66516293 3.66516293
  3.66516293 3.66516293]]
</pre></div></div>
</div>
<p>Run the sampler</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">nsteps</span> <span class="o">=</span> <span class="mi">2000</span>
<span class="n">last_sample</span> <span class="o">=</span> <span class="n">ensemble</span><span class="o">.</span><span class="n">run_mcmc</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">nsteps</span><span class="p">,</span> <span class="n">burn</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">progress</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">thin_by</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|███████████████████████████████████████| 1000/1000 [00:28&lt;00:00, 34.91it/s]
100%|███████████████████████████████████████| 2000/2000 [00:56&lt;00:00, 35.15it/s]
</pre></div></div>
</div>
<p>Let’s look at the last sample in terms of the <code class="docutils literal notranslate"><span class="pre">nleaves</span></code> array.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">last_sample</span><span class="o">.</span><span class="n">branches</span><span class="p">[</span><span class="s2">&quot;gauss&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">nleaves</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([[4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 5, 5, 5, 4, 5, 4, 4, 4],
       [4, 4, 5, 4, 4, 4, 4, 3, 3, 4, 3, 3, 4, 3, 5, 4, 4, 5, 4, 3],
       [3, 4, 3, 3, 4, 3, 3, 3, 4, 3, 3, 3, 3, 4, 5, 4, 3, 4, 4, 3],
       [3, 3, 3, 3, 3, 4, 3, 3, 4, 2, 2, 3, 2, 3, 3, 3, 3, 3, 2, 5],
       [5, 3, 3, 3, 3, 3, 2, 3, 3, 3, 2, 4, 5, 4, 6, 2, 2, 3, 2, 3],
       [3, 4, 4, 4, 5, 5, 4, 3, 4, 2, 2, 4, 2, 2, 4, 4, 3, 4, 3, 2],
       [2, 3, 4, 3, 4, 2, 2, 3, 4, 3, 5, 3, 1, 3, 1, 1, 3, 3, 2, 3],
       [4, 2, 3, 4, 2, 1, 2, 5, 8, 4, 5, 5, 1, 5, 6, 2, 1, 7, 2, 3]])
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;max ll: </span><span class="si">{</span><span class="n">ensemble</span><span class="o">.</span><span class="n">get_log_like</span><span class="p">()</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="n">nleaves</span> <span class="o">=</span> <span class="n">ensemble</span><span class="o">.</span><span class="n">get_nleaves</span><span class="p">()[</span><span class="s1">&#39;gauss&#39;</span><span class="p">]</span>
<span class="n">bns</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">nleaves_max</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.5</span>
<span class="p">)</span>  <span class="c1"># Just to make it pretty and center the bins</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">ntemps</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span>
<span class="k">for</span> <span class="n">temp</span><span class="p">,</span> <span class="n">ax_t</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ax</span><span class="p">):</span>
    <span class="n">ax_t</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">nleaves</span><span class="p">[:,</span> <span class="n">temp</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">bins</span><span class="o">=</span><span class="n">bns</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
max ll: -264.28397773302584
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_Eryn_tutorial_72_1.png" src="../_images/tutorial_Eryn_tutorial_72_1.png" />
</div>
</div>
<p>To get the samples, we need remove any binaries that were not used. We can combine <code class="docutils literal notranslate"><span class="pre">coords</span></code> and <code class="docutils literal notranslate"><span class="pre">inds</span></code> or we can remove anywhere where the backend returns <code class="docutils literal notranslate"><span class="pre">Nan</span></code>. Backends store <code class="docutils literal notranslate"><span class="pre">Nan</span></code> for the coordinates that belong to binaries that are not currently used (<code class="docutils literal notranslate"><span class="pre">inds</span> <span class="pre">==</span> <span class="pre">False</span></code>).</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">samples</span> <span class="o">=</span> <span class="n">ensemble</span><span class="o">.</span><span class="n">get_chain</span><span class="p">()[</span><span class="s1">&#39;gauss&#39;</span><span class="p">][:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">ndim</span><span class="p">)</span>

<span class="c1"># same as ensemble.get_chain()[&#39;gauss&#39;][ensemble.get_inds()[&#39;gauss&#39;]]</span>
<span class="n">samples</span> <span class="o">=</span> <span class="n">samples</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">samples</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])]</span>

<span class="n">means</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">gauss_inj_params</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">]</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">corner</span><span class="o">.</span><span class="n">corner</span><span class="p">(</span><span class="n">samples</span><span class="p">)</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">axes</span>

<span class="k">for</span> <span class="n">mean</span> <span class="ow">in</span> <span class="n">means</span><span class="p">:</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">mean</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_Eryn_tutorial_74_0.png" src="../_images/tutorial_Eryn_tutorial_74_0.png" />
</div>
</div>
</section>
<section id="Add-multiple-branches">
<h2>Add multiple branches<a class="headerlink" href="#Add-multiple-branches" title="Permalink to this headline">¶</a></h2>
<p>Now we will add another model to our reversible jump problem. We will add a sine wave model.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">gaussian_pulse</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
    <span class="n">f_x</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">((</span><span class="n">x</span> <span class="o">-</span> <span class="n">b</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">c</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">f_x</span>

<span class="k">def</span> <span class="nf">combine_gaussians</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
    <span class="n">template</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
        <span class="n">template</span> <span class="o">+=</span> <span class="n">gaussian_pulse</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="o">*</span><span class="n">param</span><span class="p">)</span>  <span class="c1"># *params -&gt; a, b, c</span>
    <span class="k">return</span> <span class="n">template</span>

<span class="k">def</span> <span class="nf">sine</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
    <span class="n">f_x</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">b</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="n">c</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">f_x</span>

<span class="k">def</span> <span class="nf">combine_sine</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
    <span class="n">template</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
        <span class="n">template</span> <span class="o">+=</span> <span class="n">sine</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="o">*</span><span class="n">param</span><span class="p">)</span>  <span class="c1"># *params -&gt; a, b, c</span>
    <span class="k">return</span> <span class="n">template</span>

<span class="k">def</span> <span class="nf">log_like_fn_gauss_and_sine</span><span class="p">(</span><span class="n">params_both</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">sigma</span><span class="p">):</span>

    <span class="n">params_gauss</span><span class="p">,</span> <span class="n">params_sine</span> <span class="o">=</span> <span class="n">params_both</span>
    <span class="n">template</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">params_gauss</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">template</span> <span class="o">+=</span> <span class="n">combine_gaussians</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">params_gauss</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">params_sine</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">template</span> <span class="o">+=</span> <span class="n">combine_sine</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">params_sine</span><span class="p">)</span>

    <span class="n">ll</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(((</span><span class="n">template</span> <span class="o">-</span> <span class="n">data</span><span class="p">)</span> <span class="o">/</span> <span class="n">sigma</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ll</span>


<span class="n">nwalkers</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">ntemps</span> <span class="o">=</span> <span class="mi">8</span>
<span class="n">ndims</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="n">nleaves_max</span> <span class="o">=</span> <span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
<span class="n">nleaves_min</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>

<span class="n">branch_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;gauss&quot;</span><span class="p">,</span> <span class="s2">&quot;sine&quot;</span><span class="p">]</span>

<span class="c1"># define time stream</span>
<span class="n">num</span> <span class="o">=</span> <span class="mi">500</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">num</span><span class="p">)</span>

<span class="n">gauss_inj_params</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">[</span><span class="mf">3.3</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">2.6</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">3.4</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">2.9</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">],</span>
<span class="p">]</span>

<span class="n">sine_inj_params</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">[</span><span class="mf">1.3</span><span class="p">,</span> <span class="mf">10.1</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">4.6</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">],</span>
<span class="p">]</span>

<span class="c1"># combine gaussians</span>
<span class="n">injection</span> <span class="o">=</span> <span class="n">combine_gaussians</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">gauss_inj_params</span><span class="p">))</span>
<span class="n">injection</span> <span class="o">+=</span> <span class="n">combine_sine</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">sine_inj_params</span><span class="p">))</span>

<span class="c1"># set noise level</span>
<span class="n">sigma</span> <span class="o">=</span> <span class="mf">2.0</span>

<span class="c1"># produce full data</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">injection</span> <span class="o">+</span> <span class="n">sigma</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">injection</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;lightskyblue&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">injection</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;injection&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;crimson&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.legend.Legend at 0x160b94cd0&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_Eryn_tutorial_77_1.png" src="../_images/tutorial_Eryn_tutorial_77_1.png" />
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">coords</span></code> and <code class="docutils literal notranslate"><span class="pre">inds</span></code></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">coords</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;gauss&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">ntemps</span><span class="p">,</span> <span class="n">nwalkers</span><span class="p">,</span> <span class="n">nleaves_max</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ndims</span><span class="p">[</span><span class="mi">0</span><span class="p">])),</span>
    <span class="s2">&quot;sine&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">ntemps</span><span class="p">,</span> <span class="n">nwalkers</span><span class="p">,</span> <span class="n">nleaves_max</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ndims</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
<span class="p">}</span>

<span class="c1"># make sure to start near the proper setup</span>
<span class="n">inds</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;gauss&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">ntemps</span><span class="p">,</span> <span class="n">nwalkers</span><span class="p">,</span> <span class="n">nleaves_max</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">),</span>
    <span class="s2">&quot;sine&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">ntemps</span><span class="p">,</span> <span class="n">nwalkers</span><span class="p">,</span> <span class="n">nleaves_max</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
<span class="p">}</span>


<span class="c1"># this is the sigma for the multivariate Gaussian that sets starting points</span>
<span class="c1"># We need it to be very small to assume we are passed the search phase</span>
<span class="c1"># we will verify this is with likelihood calculations</span>
<span class="n">sig1</span> <span class="o">=</span> <span class="mf">0.0001</span>

<span class="c1"># setup initial walkers to be the correct count (it will spread out)</span>
<span class="c1"># start with gaussians</span>
<span class="k">for</span> <span class="n">nn</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nleaves_max</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
    <span class="k">if</span> <span class="n">nn</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">gauss_inj_params</span><span class="p">):</span>
        <span class="c1"># not going to add parameters for these unused leaves</span>
        <span class="k">continue</span>
    <span class="n">coords</span><span class="p">[</span><span class="s2">&quot;gauss&quot;</span><span class="p">][:,</span> <span class="p">:,</span> <span class="n">nn</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">multivariate_normal</span><span class="p">(</span><span class="n">gauss_inj_params</span><span class="p">[</span><span class="n">nn</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="n">sig1</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">ntemps</span><span class="p">,</span> <span class="n">nwalkers</span><span class="p">))</span>
    <span class="n">inds</span><span class="p">[</span><span class="s2">&quot;gauss&quot;</span><span class="p">][:,</span> <span class="p">:,</span> <span class="n">nn</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

<span class="c1"># next do sine waves</span>
<span class="k">for</span> <span class="n">nn</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nleaves_max</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
    <span class="k">if</span> <span class="n">nn</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sine_inj_params</span><span class="p">):</span>
        <span class="c1"># not going to add parameters for these unused leaves</span>
        <span class="k">continue</span>
    <span class="n">coords</span><span class="p">[</span><span class="s2">&quot;sine&quot;</span><span class="p">][:,</span> <span class="p">:,</span> <span class="n">nn</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">multivariate_normal</span><span class="p">(</span><span class="n">sine_inj_params</span><span class="p">[</span><span class="n">nn</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="n">sig1</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">ntemps</span><span class="p">,</span> <span class="n">nwalkers</span><span class="p">))</span>
    <span class="n">inds</span><span class="p">[</span><span class="s2">&quot;sine&quot;</span><span class="p">][:,</span> <span class="p">:,</span> <span class="n">nn</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

</pre></div>
</div>
</div>
<p>Priors are defined per model for a single model. It will take into account multiple models by summing the prior probability over the leaves.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># describes priors for all leaves independently</span>
<span class="n">priors</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;gauss&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="mi">0</span><span class="p">:</span> <span class="n">uniform_dist</span><span class="p">(</span><span class="mf">2.5</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">),</span>  <span class="c1"># amplitude</span>
        <span class="mi">1</span><span class="p">:</span> <span class="n">uniform_dist</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">t</span><span class="o">.</span><span class="n">max</span><span class="p">()),</span>  <span class="c1"># mean</span>
        <span class="mi">2</span><span class="p">:</span> <span class="n">uniform_dist</span><span class="p">(</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.21</span><span class="p">),</span>  <span class="c1"># sigma</span>
    <span class="p">},</span>
    <span class="s2">&quot;sine&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="mi">0</span><span class="p">:</span> <span class="n">uniform_dist</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">),</span>  <span class="c1"># amplitude</span>
        <span class="mi">1</span><span class="p">:</span> <span class="n">uniform_dist</span><span class="p">(</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">20.</span><span class="p">),</span>  <span class="c1"># mean</span>
        <span class="mi">2</span><span class="p">:</span> <span class="n">uniform_dist</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">),</span>  <span class="c1"># sigma</span>
    <span class="p">},</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<p>You can add multiple covariance matrices. One for each branch. We will keep it the same for simplicity.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># for the Gaussian Move, will be explained later</span>
<span class="n">factor</span> <span class="o">=</span> <span class="mf">0.00001</span>
<span class="n">cov</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;gauss&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">ndims</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="o">*</span> <span class="n">factor</span><span class="p">,</span>
    <span class="s2">&quot;sine&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">ndims</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span> <span class="o">*</span> <span class="n">factor</span>
<span class="p">}</span>

<span class="n">moves</span> <span class="o">=</span> <span class="n">GaussianMove</span><span class="p">(</span><span class="n">cov</span><span class="p">)</span>

</pre></div>
</div>
</div>
<p>We will now initialize the sampler by adding the branch, tempering, leaf, and move information.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">ensemble</span> <span class="o">=</span> <span class="n">EnsembleSampler</span><span class="p">(</span>
    <span class="n">nwalkers</span><span class="p">,</span>
    <span class="n">ndims</span><span class="p">,</span>
    <span class="n">log_like_fn_gauss_and_sine</span><span class="p">,</span>
    <span class="n">priors</span><span class="p">,</span>
    <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">sigma</span><span class="p">],</span>
    <span class="n">tempering_kwargs</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">ntemps</span><span class="o">=</span><span class="n">ntemps</span><span class="p">),</span>
    <span class="n">nbranches</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">branch_names</span><span class="p">),</span>
    <span class="n">branch_names</span><span class="o">=</span><span class="n">branch_names</span><span class="p">,</span>
    <span class="n">nleaves_max</span><span class="o">=</span><span class="n">nleaves_max</span><span class="p">,</span>
    <span class="n">nleaves_min</span><span class="o">=</span><span class="n">nleaves_min</span><span class="p">,</span>
    <span class="n">moves</span><span class="o">=</span><span class="n">moves</span><span class="p">,</span>
    <span class="n">rj_moves</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># basic generation of new leaves from the prior</span>
<span class="p">)</span>


</pre></div>
</div>
</div>
<p>Prior, Likelihood, and initial state.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[36]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>

<span></span><span class="n">log_prior</span> <span class="o">=</span> <span class="n">ensemble</span><span class="o">.</span><span class="n">compute_log_prior</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">inds</span><span class="o">=</span><span class="n">inds</span><span class="p">)</span>
<span class="n">log_like</span> <span class="o">=</span> <span class="n">ensemble</span><span class="o">.</span><span class="n">compute_log_like</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">inds</span><span class="o">=</span><span class="n">inds</span><span class="p">,</span> <span class="n">logp</span><span class="o">=</span><span class="n">log_prior</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># make sure it is reasonably close to the maximum which this is</span>
<span class="c1"># will not be zero due to noise</span>
<span class="nb">print</span><span class="p">(</span><span class="n">log_like</span><span class="p">,</span> <span class="n">log_prior</span><span class="p">)</span>

<span class="c1"># setup starting state</span>
<span class="n">state</span> <span class="o">=</span> <span class="n">State</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">log_like</span><span class="o">=</span><span class="n">log_like</span><span class="p">,</span> <span class="n">log_prior</span><span class="o">=</span><span class="n">log_prior</span><span class="p">,</span> <span class="n">inds</span><span class="o">=</span><span class="n">inds</span><span class="p">)</span>

</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[[-270.18222328 -273.91483163 -272.46651627 -269.81289525 -269.90527322
  -268.5631434  -269.28556934 -270.72567978 -274.48361286 -277.7611585
  -272.32687579 -267.55112232 -269.55139788 -279.17201886 -269.8368919
  -268.70932497 -272.46377168 -270.33703176 -269.65656691 -268.012328  ]
 [-270.95662303 -268.96498389 -273.13449296 -275.23386433 -269.48374723
  -273.95875502 -268.70399136 -280.89455029 -268.37657779 -269.66814296
  -269.41757529 -275.55932847 -278.52390119 -268.29349209 -267.40245718
  -268.87149849 -271.5265131  -272.29613475 -269.68238612 -270.62308891]
 [-270.44004897 -268.5942155  -271.81207629 -269.09211719 -268.67720588
  -267.29900502 -269.31793641 -268.53732661 -270.67002611 -269.39505669
  -271.1131799  -270.09496514 -272.80362829 -268.00816866 -267.28100697
  -277.14318176 -268.90379138 -266.69112728 -271.52032743 -269.35917109]
 [-271.85238347 -270.25091262 -269.59173328 -271.33091727 -271.33862164
  -271.53428125 -269.38550154 -274.50893561 -276.47167734 -273.2540056
  -274.00443977 -270.27861629 -272.1942677  -275.41783191 -269.03269294
  -267.82833124 -271.49576289 -267.94385382 -268.798468   -276.03173086]
 [-270.26836692 -270.52305452 -270.90306018 -267.78294141 -269.5870663
  -271.93091632 -268.63858748 -269.46260887 -274.05938426 -270.47087664
  -272.67406144 -269.29803605 -269.82740993 -269.50317304 -269.63030838
  -268.07243875 -271.59457607 -269.55099287 -271.51397519 -269.01448414]
 [-267.89563166 -279.3330612  -268.46177198 -271.20877421 -270.03393325
  -268.65230833 -271.09135884 -268.84551574 -270.61321328 -268.13110448
  -269.95299147 -268.89811995 -275.61753676 -268.3713304  -272.35323413
  -271.35596381 -268.31565016 -268.41655652 -270.19262726 -272.29746794]
 [-269.00560379 -270.65755309 -275.81454804 -268.71429805 -270.13970655
  -302.31669161 -273.21285936 -273.09415384 -276.14998396 -268.6436378
  -268.19129668 -273.13880537 -272.33600739 -272.81488805 -270.52338548
  -272.37147871 -269.63060647 -272.12135163 -271.15892496 -284.34958776]
 [-267.22329041 -278.88580446 -269.2570073  -269.76031394 -270.43745164
  -268.09683891 -271.58593258 -267.9211962  -270.19527835 -268.10018974
  -267.45267864 -269.28350835 -272.56683874 -268.72050046 -270.2126153
  -270.51532408 -276.21992792 -274.0324881  -273.89850751 -268.63744382]] [[-5.89946916 -5.89946916 -5.89946916 -5.89946916 -5.89946916 -5.89946916
  -5.89946916 -5.89946916 -5.89946916 -5.89946916 -5.89946916 -5.89946916
  -5.89946916 -5.89946916 -5.89946916 -5.89946916 -5.89946916 -5.89946916
  -5.89946916 -5.89946916]
 [-5.89946916 -5.89946916 -5.89946916 -5.89946916 -5.89946916 -5.89946916
  -5.89946916 -5.89946916 -5.89946916 -5.89946916 -5.89946916 -5.89946916
  -5.89946916 -5.89946916 -5.89946916 -5.89946916 -5.89946916 -5.89946916
  -5.89946916 -5.89946916]
 [-5.89946916 -5.89946916 -5.89946916 -5.89946916 -5.89946916 -5.89946916
  -5.89946916 -5.89946916 -5.89946916 -5.89946916 -5.89946916 -5.89946916
  -5.89946916 -5.89946916 -5.89946916 -5.89946916 -5.89946916 -5.89946916
  -5.89946916 -5.89946916]
 [-5.89946916 -5.89946916 -5.89946916 -5.89946916 -5.89946916 -5.89946916
  -5.89946916 -5.89946916 -5.89946916 -5.89946916 -5.89946916 -5.89946916
  -5.89946916 -5.89946916 -5.89946916 -5.89946916 -5.89946916 -5.89946916
  -5.89946916 -5.89946916]
 [-5.89946916 -5.89946916 -5.89946916 -5.89946916 -5.89946916 -5.89946916
  -5.89946916 -5.89946916 -5.89946916 -5.89946916 -5.89946916 -5.89946916
  -5.89946916 -5.89946916 -5.89946916 -5.89946916 -5.89946916 -5.89946916
  -5.89946916 -5.89946916]
 [-5.89946916 -5.89946916 -5.89946916 -5.89946916 -5.89946916 -5.89946916
  -5.89946916 -5.89946916 -5.89946916 -5.89946916 -5.89946916 -5.89946916
  -5.89946916 -5.89946916 -5.89946916 -5.89946916 -5.89946916 -5.89946916
  -5.89946916 -5.89946916]
 [-5.89946916 -5.89946916 -5.89946916 -5.89946916 -5.89946916 -5.89946916
  -5.89946916 -5.89946916 -5.89946916 -5.89946916 -5.89946916 -5.89946916
  -5.89946916 -5.89946916 -5.89946916 -5.89946916 -5.89946916 -5.89946916
  -5.89946916 -5.89946916]
 [-5.89946916 -5.89946916 -5.89946916 -5.89946916 -5.89946916 -5.89946916
  -5.89946916 -5.89946916 -5.89946916 -5.89946916 -5.89946916 -5.89946916
  -5.89946916 -5.89946916 -5.89946916 -5.89946916 -5.89946916 -5.89946916
  -5.89946916 -5.89946916]]
</pre></div></div>
</div>
<p>Run the sampler</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[37]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">state</span><span class="o">.</span><span class="n">branches</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[37]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;gauss&#39;: &lt;eryn.state.Branch at 0x160b4e550&gt;,
 &#39;sine&#39;: &lt;eryn.state.Branch at 0x1618ab1f0&gt;}
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[38]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">nsteps</span> <span class="o">=</span> <span class="mi">5000</span>
<span class="n">last_sample</span> <span class="o">=</span> <span class="n">ensemble</span><span class="o">.</span><span class="n">run_mcmc</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">nsteps</span><span class="p">,</span> <span class="n">burn</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">progress</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">thin_by</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|███████████████████████████████████████| 1000/1000 [00:44&lt;00:00, 22.41it/s]
100%|███████████████████████████████████████| 5000/5000 [03:41&lt;00:00, 22.59it/s]
</pre></div></div>
</div>
<p>Let’s look at the last sample in terms of the <code class="docutils literal notranslate"><span class="pre">nleaves</span></code> array for both branches in the cold chain.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[39]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">last_sample</span><span class="o">.</span><span class="n">branches</span><span class="p">[</span><span class="s2">&quot;gauss&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">nleaves</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">last_sample</span><span class="o">.</span><span class="n">branches</span><span class="p">[</span><span class="s2">&quot;sine&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">nleaves</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[39]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([[4, 2],
       [4, 2],
       [5, 1],
       [4, 4],
       [4, 2],
       [4, 2],
       [4, 2],
       [4, 2],
       [4, 2],
       [4, 2],
       [4, 2],
       [4, 2],
       [4, 2],
       [4, 2],
       [4, 2],
       [4, 2],
       [4, 2],
       [4, 2],
       [7, 1],
       [4, 2]])
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[40]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;max ll: </span><span class="si">{</span><span class="n">ensemble</span><span class="o">.</span><span class="n">get_log_like</span><span class="p">()</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="n">nleaves_gauss</span> <span class="o">=</span> <span class="n">ensemble</span><span class="o">.</span><span class="n">get_nleaves</span><span class="p">()[</span><span class="s1">&#39;gauss&#39;</span><span class="p">]</span>
<span class="n">nleaves_sine</span> <span class="o">=</span> <span class="n">ensemble</span><span class="o">.</span><span class="n">get_nleaves</span><span class="p">()[</span><span class="s1">&#39;sine&#39;</span><span class="p">]</span>
<span class="n">bns</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">nleaves_max</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.5</span>
<span class="p">)</span>  <span class="c1"># Just to make it pretty and center the bins</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">ntemps</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span>
<span class="k">for</span> <span class="n">temp</span><span class="p">,</span> <span class="n">ax_t</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ax</span><span class="p">):</span>
    <span class="n">ax_t</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">nleaves_gauss</span><span class="p">[:,</span> <span class="n">temp</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">bins</span><span class="o">=</span><span class="n">bns</span><span class="p">,</span> <span class="n">histtype</span><span class="o">=</span><span class="s2">&quot;step&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;gauss&quot;</span><span class="p">)</span>
    <span class="n">ax_t</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">nleaves_sine</span><span class="p">[:,</span> <span class="n">temp</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">bins</span><span class="o">=</span><span class="n">bns</span><span class="p">,</span> <span class="n">histtype</span><span class="o">=</span><span class="s2">&quot;step&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;sine&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
max ll: -257.1050154143706
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[40]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.legend.Legend at 0x15fa40250&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_Eryn_tutorial_93_2.png" src="../_images/tutorial_Eryn_tutorial_93_2.png" />
</div>
</div>
<p>To get the samples, we need remove any binaries that were not used. We can combine <code class="docutils literal notranslate"><span class="pre">coords</span></code> and <code class="docutils literal notranslate"><span class="pre">inds</span></code> or we can remove anywhere where the backend returns <code class="docutils literal notranslate"><span class="pre">Nan</span></code>. Backends store <code class="docutils literal notranslate"><span class="pre">Nan</span></code> for the coordinates that belong to binaries that are not currently used (<code class="docutils literal notranslate"><span class="pre">inds</span> <span class="pre">==</span> <span class="pre">False</span></code>).</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[41]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">samples</span> <span class="o">=</span> <span class="n">ensemble</span><span class="o">.</span><span class="n">get_chain</span><span class="p">()[</span><span class="s1">&#39;gauss&#39;</span><span class="p">][:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">ndim</span><span class="p">)</span>

<span class="c1"># same as ensemble.get_chain()[&#39;gauss&#39;][ensemble.get_inds()[&#39;gauss&#39;]]</span>
<span class="n">samples</span> <span class="o">=</span> <span class="n">samples</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">samples</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])]</span>

<span class="n">means</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">gauss_inj_params</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">]</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">corner</span><span class="o">.</span><span class="n">corner</span><span class="p">(</span><span class="n">samples</span><span class="p">)</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">axes</span>

<span class="k">for</span> <span class="n">mean</span> <span class="ow">in</span> <span class="n">means</span><span class="p">:</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">mean</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_Eryn_tutorial_95_0.png" src="../_images/tutorial_Eryn_tutorial_95_0.png" />
</div>
</div>
</section>
</section>
<section id="Utilities">
<h1>Utilities<a class="headerlink" href="#Utilities" title="Permalink to this headline">¶</a></h1>
<section id="Transform-Container">
<h2>Transform Container<a class="headerlink" href="#Transform-Container" title="Permalink to this headline">¶</a></h2>
<p>Transform containers are primary used in likelihood functions to transform the arrays incoming from the sampler to the proper setup for likelihood computation. It can transform parameters based on transform functions and fill values into a final array for any value that is fixed during sampling.</p>
<p>It can be passed to the likeihood function as an <code class="docutils literal notranslate"><span class="pre">arg</span></code> or <code class="docutils literal notranslate"><span class="pre">kwarg</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[42]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># can be done with lambda or regular function</span>
<span class="c1"># must have same number of inputs and outputs at same index in outer arrays</span>
<span class="k">def</span> <span class="nf">transform1</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">*</span> <span class="n">y</span><span class="p">,</span> <span class="n">y</span> <span class="o">/</span> <span class="n">x</span>

<span class="c1"># this will do transform lambda x, y: (x**2, y**2) before transform1</span>
<span class="n">parameter_transforms</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">y</span><span class="o">**</span><span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span> <span class="n">transform1</span><span class="p">}</span>

<span class="n">fill_dict</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;ndim_full&quot;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>  <span class="c1"># full dimensionality after values are added</span>
    <span class="s2">&quot;fill_inds&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">]),</span>  <span class="c1"># indexes for fill values in final array</span>
    <span class="s2">&quot;fill_values&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">]),</span>  <span class="c1"># associated values for filling</span>
<span class="p">}</span>

<span class="n">tc</span> <span class="o">=</span> <span class="n">TransformContainer</span><span class="p">(</span><span class="n">parameter_transforms</span><span class="o">=</span><span class="n">parameter_transforms</span><span class="p">,</span> <span class="n">fill_dict</span><span class="o">=</span><span class="n">fill_dict</span><span class="p">)</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>

<span class="c1"># can copy and transpose values if needed</span>
<span class="n">out</span> <span class="o">=</span> <span class="n">tc</span><span class="o">.</span><span class="n">transform_base_parameters</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">return_transpose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[[-8.89824600e+00  2.75758048e-01 -2.09331349e+01]
 [ 1.02492326e-02  1.32772775e+01  1.75345322e-01]
 [-2.81279324e+00  9.14271804e+00 -1.83355615e+00]
 [ 4.07418397e-01  6.42259918e-01  4.87400928e+00]
 [-3.48989745e+00  4.70139219e-02 -2.78947139e+01]
 [ 4.93180412e-01  3.82208706e+00  7.05874949e-01]
 [-5.80739413e-02  5.50305988e+00 -9.16114086e+01]
 [ 1.85092106e-02  1.51885887e-02  8.97722522e-01]
 [ 1.02252084e+01  8.24620718e+00  6.07759460e+00]
 [ 3.31476465e+00  5.53780669e+00  1.82282099e+00]
 [ 2.07561361e-01  4.87225744e-01  1.58798660e-01]
 [ 9.37869669e-01  9.13213783e-01  2.47727995e+01]
 [ 2.12881693e+00  1.51298347e+01  2.62247546e+00]
 [ 2.27993071e-02  5.79348414e+00  1.53860020e-01]
 [ 2.56863395e+00  3.84163824e+00  2.36049137e+00]
 [ 5.75727221e+00  1.73481940e+00  3.27124518e+00]
 [ 6.36614125e+00  3.00705547e-02  4.19023730e+00]
 [ 2.65703779e+00  1.96439673e-02  3.20887239e+00]
 [ 1.44122169e+00  1.17216981e+01  1.27049419e+00]
 [ 2.37199099e-01  2.72218284e+00  3.82731038e-01]
 [ 4.57728566e-01  1.60909766e+00  1.87976175e+00]
 [-3.26100428e+00  1.10266855e+01 -1.42615262e+01]
 [ 1.16785325e+00  8.11980880e-01  7.90309504e+00]
 [ 9.29154964e+00  9.79386760e+00  8.70209707e+00]
 [ 8.68811812e+00  8.60287505e+00  7.95976383e+00]
 [ 1.44566213e+01  2.07672853e+00  1.49903908e+01]
 [ 7.48013935e+00  8.60681557e+00  2.01650855e+01]
 [ 6.96361528e+00  1.19269308e+01  2.41088987e+01]
 [ 1.34545605e+00  1.31263341e+01  1.25599247e+00]
 [ 2.08020121e-01  9.88718542e-02  1.57497312e+01]
 [-5.19306610e-02  4.44199127e+00 -2.52010277e+01]
 [ 2.49646857e+00  1.94517770e+00  1.40627517e+01]
 [ 7.20331569e+00  7.03272081e+00  1.13078176e+01]
 [-2.92496271e+00  1.56717511e+01 -4.19225985e+00]
 [ 3.26949671e+00  1.82888187e+00  1.46711772e+01]
 [-3.04587362e-01  7.76705784e-01 -1.20637203e-01]
 [ 5.79070427e+00  1.06061179e+01  8.49930387e+00]
 [ 2.12904725e+01  1.28296723e+00  1.11995112e+01]
 [ 4.55772389e+00  2.03411610e+00  2.96299913e+00]
 [ 4.24447822e-01  4.73427344e+00  2.02518868e+01]]
</pre></div></div>
</div>
<p>If you have mutliple branches in your sampler, you can add more than one <code class="docutils literal notranslate"><span class="pre">Transform</span> <span class="pre">Container</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[43]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">lnprob</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">group1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">group2</span><span class="p">,</span> <span class="n">transform_containers</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">x_i</span><span class="p">,</span> <span class="n">transform</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">([</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">],</span> <span class="n">transform_containers</span><span class="p">)):</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="n">transform</span><span class="o">.</span><span class="n">transform_base_parameters</span><span class="p">(</span><span class="n">x_i</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">return_transpose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">transform</span><span class="o">.</span><span class="n">fill_values</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="c1">## do more in the likelihood here with transformed information</span>

<span class="c1"># setup transforms for x1</span>
<span class="n">parameter_transforms1</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x</span><span class="p">)}</span>

<span class="c1"># setup transforms for x2</span>
<span class="n">parameter_transforms2</span> <span class="o">=</span> <span class="p">{(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">y</span><span class="o">**</span><span class="mi">2</span><span class="p">)}</span>

<span class="c1"># fill dict for x1</span>
<span class="n">fill_dict1</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;ndim_full&quot;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>  <span class="c1"># full dimensionality after values are added</span>
    <span class="s2">&quot;fill_inds&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">]),</span>  <span class="c1"># indexes for fill values in final array</span>
    <span class="s2">&quot;fill_values&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">]),</span>  <span class="c1"># associated values for filling</span>
<span class="p">}</span>

<span class="c1"># fill dict for x2</span>
<span class="n">fill_dict2</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;ndim_full&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>  <span class="c1"># full dimensionality after values are added</span>
    <span class="s2">&quot;fill_inds&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">]),</span>  <span class="c1"># indexes for fill values in final array</span>
    <span class="s2">&quot;fill_values&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">1.0</span><span class="p">]),</span>  <span class="c1"># associated values for filling</span>
<span class="p">}</span>

<span class="n">tcs</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">TransformContainer</span><span class="p">(</span><span class="n">parameter_transforms</span><span class="o">=</span><span class="n">parameter_transforms1</span><span class="p">,</span> <span class="n">fill_dict</span><span class="o">=</span><span class="n">fill_dict1</span><span class="p">),</span>
    <span class="n">TransformContainer</span><span class="p">(</span><span class="n">parameter_transforms</span><span class="o">=</span><span class="n">parameter_transforms2</span><span class="p">,</span> <span class="n">fill_dict</span><span class="o">=</span><span class="n">fill_dict2</span><span class="p">),</span>
<span class="p">]</span>

<span class="n">num</span> <span class="o">=</span> <span class="mi">40</span>
<span class="n">x1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="n">x2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

<span class="n">group1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
<span class="n">group2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>

<span class="c1"># it can be added via args or kwargs in the ensemble sampler</span>
<span class="n">lnprob</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">group1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">group2</span><span class="p">,</span> <span class="n">tcs</span><span class="p">)</span>

</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[array([[ 1.29219658,  0.89103652,  0.        ,  1.        ,  1.59175421,
        -1.        ],
       [-0.64343493,  2.749268  ,  0.        ,  1.        ,  1.73521835,
        -1.        ],
       [ 0.60380671,  2.83535257,  0.        ,  1.        ,  0.67350255,
        -1.        ],
       [ 0.49766419,  1.49693707,  0.        ,  1.        ,  2.87178732,
        -1.        ],
       [ 1.15240521,  0.42166027,  0.        ,  1.        ,  1.26487705,
        -1.        ],
       [ 1.35974848,  3.90306073,  0.        ,  1.        ,  0.23891919,
        -1.        ],
       [ 1.27390424,  0.56240086,  0.        ,  1.        ,  3.15331684,
        -1.        ],
       [ 1.16158241,  3.02091525,  0.        ,  1.        ,  1.19717386,
        -1.        ],
       [ 0.46917265,  1.88663526,  0.        ,  1.        ,  0.74725524,
        -1.        ],
       [ 1.3318928 ,  3.60261829,  0.        ,  1.        ,  1.66753246,
        -1.        ],
       [-2.23547549,  2.78488996,  0.        ,  1.        ,  2.22360197,
        -1.        ],
       [ 1.37729934,  1.21653633,  0.        ,  1.        ,  2.92146055,
        -1.        ],
       [ 1.38255117,  1.04055599,  0.        ,  1.        ,  3.61528113,
        -1.        ],
       [-0.17255025,  0.30856284,  0.        ,  1.        ,  2.33266672,
        -1.        ],
       [-0.72191913,  0.97264439,  0.        ,  1.        ,  3.68262329,
        -1.        ],
       [ 1.14663581,  2.24664567,  0.        ,  1.        ,  2.38873411,
        -1.        ],
       [ 1.02781403,  0.43212754,  0.        ,  1.        ,  3.06706675,
        -1.        ],
       [ 1.34773401,  2.28539547,  0.        ,  1.        ,  0.57915313,
        -1.        ],
       [-0.01212452,  3.43080904,  0.        ,  1.        ,  2.18485058,
        -1.        ],
       [ 1.37741496,  2.61295912,  0.        ,  1.        ,  0.99911576,
        -1.        ],
       [ 1.36319339,  3.59038342,  0.        ,  1.        ,  1.46118363,
        -1.        ],
       [ 0.34493979,  3.7176707 ,  0.        ,  1.        ,  3.44514314,
        -1.        ],
       [ 0.45381328,  3.56148359,  0.        ,  1.        ,  1.70383736,
        -1.        ],
       [ 0.65790767,  3.11433413,  0.        ,  1.        ,  0.81669409,
        -1.        ],
       [ 0.63333776,  2.40394457,  0.        ,  1.        ,  1.93194405,
        -1.        ],
       [ 1.02930373,  0.23359119,  0.        ,  1.        ,  0.78541837,
        -1.        ],
       [ 0.2493433 ,  2.40272271,  0.        ,  1.        ,  1.79710943,
        -1.        ],
       [ 0.82469172,  2.00277215,  0.        ,  1.        ,  3.6803279 ,
        -1.        ],
       [ 0.08781097,  0.53659263,  0.        ,  1.        ,  1.41142981,
        -1.        ],
       [ 0.38777842,  3.97038431,  0.        ,  1.        ,  2.92767041,
        -1.        ],
       [-0.02539442,  0.82891016,  0.        ,  1.        ,  2.6328635 ,
        -1.        ],
       [ 0.28760736,  1.7093836 ,  0.        ,  1.        ,  0.87388842,
        -1.        ],
       [ 0.89039136,  3.27760158,  0.        ,  1.        ,  2.30801658,
        -1.        ],
       [ 0.92086951,  3.06000948,  0.        ,  1.        ,  3.59079707,
        -1.        ],
       [-1.27772507,  3.7485542 ,  0.        ,  1.        ,  3.63956984,
        -1.        ],
       [ 0.77428597,  2.00576165,  0.        ,  1.        ,  2.25413429,
        -1.        ],
       [ 1.27951051,  0.45114069,  0.        ,  1.        ,  0.66948651,
        -1.        ],
       [ 0.77521708,  3.83689982,  0.        ,  1.        ,  3.20104287,
        -1.        ],
       [ 0.23424483,  1.6296988 ,  0.        ,  1.        ,  0.48615737,
        -1.        ],
       [ 1.05356139,  1.28560494,  0.        ,  1.        ,  1.23577008,
        -1.        ]]), array([[ 1.64300873, -1.        ,  0.59067396,  5.68827437,  1.53200262],
       [ 1.5388902 , -1.        ,  5.29411884,  0.19822197,  2.63367709],
       [ 2.44764633, -1.        , 12.64799394,  8.47760581,  3.84009573],
       [ 2.35235349, -1.        ,  1.51215884,  4.37857264,  3.18555067],
       [ 2.94264702, -1.        , 14.69989749,  1.72018709,  2.52698783],
       [ 2.15787055, -1.        ,  0.8062175 ,  0.02428886,  1.08047564],
       [ 0.29827033, -1.        ,  8.9589593 ,  3.25168148,  3.95449299],
       [ 3.67777923, -1.        , 12.69540869, 11.90671516,  3.28801972],
       [ 3.41890905, -1.        ,  1.61653802, 10.93412664,  1.54696024],
       [ 3.44813104, -1.        ,  8.42774624, 13.18792008,  1.25919773],
       [ 1.42555218, -1.        , 11.44608534,  0.96435291,  0.13296387],
       [ 3.25713217, -1.        ,  2.54918892,  2.19626224,  1.12285216],
       [ 1.75924246, -1.        , 14.82600988,  9.0739916 ,  2.01847671],
       [ 2.4973196 , -1.        ,  8.74334826,  1.55928923,  2.50322982],
       [ 3.23708121, -1.        ,  4.18772427,  2.40352723,  1.75110317],
       [ 3.15851227, -1.        ,  1.09093877,  0.9108759 ,  3.32200093],
       [ 0.29644844, -1.        ,  1.56143305,  0.13123834,  1.92921904],
       [ 3.70476966, -1.        , 13.77193467,  2.32975678,  2.34812269],
       [ 3.30503404, -1.        ,  0.95561718,  0.12567715,  0.63200636],
       [ 1.67070509, -1.        , 11.84122934,  0.66002489,  2.63852803],
       [ 1.88955402, -1.        ,  1.4747871 ,  4.77070558,  2.55907293],
       [ 1.7348029 , -1.        ,  1.56267019,  1.55564241,  0.86717339],
       [ 2.65570265, -1.        ,  2.08760241,  6.05350797,  2.25193914],
       [ 3.46788276, -1.        , 14.03513446,  0.01958937,  2.85263237],
       [ 0.36014983, -1.        ,  1.16486787, 14.04108398,  2.19285315],
       [ 2.91636965, -1.        ,  4.52575249, 15.7700388 ,  2.54460023],
       [ 3.28783694, -1.        ,  9.25899901,  1.05105911,  1.3659882 ],
       [ 0.18323737, -1.        ,  7.49302013,  1.18537872,  1.4288355 ],
       [ 3.62878203, -1.        , 10.63137335,  9.85593519,  2.47557962],
       [ 0.64901942, -1.        ,  4.72662085,  3.6125627 ,  3.02126463],
       [ 3.4839235 , -1.        ,  0.67364661, 15.8420466 ,  3.57426471],
       [ 1.28576575, -1.        ,  2.28912333,  1.53900105,  0.92908138],
       [ 1.08709262, -1.        , 14.71185903,  6.80664724,  3.64687844],
       [ 2.72523565, -1.        ,  5.67281342,  7.33440311,  1.66137126],
       [ 2.90378581, -1.        ,  0.15555878,  4.16496782,  0.42433314],
       [ 2.10882072, -1.        ,  1.54515096, 14.44684236,  3.51387029],
       [ 3.96891511, -1.        , 11.94279961,  9.87830896,  2.21046981],
       [ 2.69191174, -1.        ,  0.12023958,  6.1567565 ,  2.35930423],
       [ 3.94001608, -1.        ,  0.8861932 ,  2.22457447,  3.25644715],
       [ 0.99428275, -1.        ,  3.78857496, 15.46633608,  3.05543778]])]
</pre></div></div>
</div>
</section>
</section>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="../user/utils.html" class="btn btn-neutral float-left" title="Utilities" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Michael Katz and Nikos Karnesis.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>